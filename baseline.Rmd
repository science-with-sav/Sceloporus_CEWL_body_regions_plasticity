---
title: "Cal Poly Herpetology CURE - Baseline Analyses"
authors: "Savannah Weaver, Dylan Stephens, Jenna Heaphy"
date: "Spring Quarter 2021"
output: github_document
---


# Rules :)

1. Write blurbs before/after code chunks to explain wtf it is and why helpful/important. For example, listing variables (otherwise I've done a poor job with this on this Rmd).
2. Comment on your code, especially to point out what doesn't work, questions you have, or uncertainties.
3. No deleting other peoples work! You can delete your own as you work on it, but otherwise keep everything. You can keep versions of things (with notes explaining that!). I may delete versions that become irrelevant, but often code will become helpful later.


# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
```



# Data

### Morphometrics and Blood Data

variables:
- date
- collection/capture time for each lizard
- individual ID for each lizard
- sock ID used to capture each lizard
- SVL = snout-vent length
- mass in grams
- sex
- if female, whether or not gravid
- which eye the blood sample was taken from
- percent hematocrit = percent of blood that's red blood cells
- osmolality = a proxy of hydration, should be inversely related to water content of a lizard (this is the average of 1-3 replicates)
- cloacal temperature at the time of CEWL measurement
- processing time for each lizard, when all measurements were finished
- hemolyzed whether or not red blood cells burst and contaminated plasma

```{r morpho blood data}
morpho_blood_dat <- read.csv("./data/Herpetology_Data.csv",
                             na.strings=c("","NA") # fix empty cells
                             ) %>%
  dplyr::mutate(date = as.Date(date, format = "%m/%d/%y"),
                collect_time = as.POSIXct(collect_time, format = "%H:%M"),
                processing_time = as.POSIXct(processing_time, format = "%H:%M"),
                sex_M_F = as.factor(sex_M_F),
                gravid_Y_N = as.factor(gravid_Y_N),
                blood_sample_eye = as.factor(blood_sample_eye),
                hemolyzed. = as.factor(hemolyzed.),
                individual_ID = as.character(individual_ID)
                ) %>%
  dplyr::filter(osmolality_mmol_kg <= 500) # remove one point I think inaccurate
summary(morpho_blood_dat)
```


### CEWL Data

```{r CEWL data}
# week 1
CEWL_April_05 <- read.csv("./data/4-5-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::mutate(week = "1") %>% # add weekend index for throughout season
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH...., # rename
                week
                )

# week 2
CEWL_April_19 <- read.csv("./data/4-19-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::mutate(week = "2") %>% # add weekend index for throughout season
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH...., # rename
                week
                )

# week 3
CEWL_April_26 <- read.csv("./data/4-26-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::mutate(week = "3") %>% # add weekend index for throughout season
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH...., # rename
                week
                )

# merge all CEWL datafiles & reformat
CEWL <- CEWL_April_05 %>%
  # join
  rbind(., CEWL_April_19, CEWL_April_26) %>%
  # remove any unsuccessful measurements
  dplyr::filter(Status == "Normal") %>%
  # reformat data
  dplyr::mutate(date_time = as.POSIXct(paste(date, Time), format = "%m/%d/%y %I:%M:%S %p"),
                # date only
                date = as.Date(date, format = "%m/%d/%y"),
                # time with arbitrary date, need to figure out how to remove
                Time = as.POSIXct(Time, format = "%I:%M:%S %p"),
                # extract individual ID number
                individual_ID = as.numeric(substring(ID, 1, 2)),
                # extract body region for CEWL measurement
                region = as.factor(substring(ID, 4, 7)),
                week = as.factor(week),
                individual_ID = as.character(individual_ID)
                ) %>%
  dplyr::select(-ID, -Status
                ) %>%
  dplyr::filter(complete.cases(.))
summary(CEWL)
unique(CEWL$region)
```


### Split CEWL Data

```{r}
# select each CEWL region separately 
CEWL_dorsum <- CEWL %>%
  dplyr::filter(region == "dors") %>%
  dplyr::select(date, individual_ID, 
                dorsum_TEWL_g_m2h = TEWL_g_m2h)
CEWL_ventrum <- CEWL %>%
  dplyr::filter(region == "vent") %>%
  dplyr::select(date, individual_ID, 
                ventrum_TEWL_g_m2h = TEWL_g_m2h)
CEWL_dewlap <- CEWL %>%
  dplyr::filter(region == "dewl") %>%
  dplyr::select(date, individual_ID, 
                dewlap_TEWL_g_m2h = TEWL_g_m2h)
CEWL_head <- CEWL %>%
  dplyr::filter(region == "head") %>%
  dplyr::select(date, individual_ID, 
                head_TEWL_g_m2h = TEWL_g_m2h)
CEWL_mitepatch <- CEWL %>%
  dplyr::filter(region == "mite") %>%
  dplyr::select(date, individual_ID, 
                mitepatch_TEWL_g_m2h = TEWL_g_m2h)

# also get average across body regions
CEWL_avg <- CEWL %>%
  group_by(individual_ID) %>%
  summarise(avg_CEWL = mean(TEWL_g_m2h)) %>%
  dplyr::select(individual_ID, avg_CEWL)
```


### Rearrange and Join

```{r join data}
# join all CEWL regions to morpho and blood data
data_full <- morpho_blood_dat %>%
  left_join(CEWL_dorsum, by = c("date", "individual_ID")) %>%
  left_join(CEWL_ventrum, by = c("date", "individual_ID")) %>%
  left_join(CEWL_dewlap, by = c("date", "individual_ID")) %>%
  left_join(CEWL_head, by = c("date", "individual_ID")) %>%
  left_join(CEWL_mitepatch, by = c("date", "individual_ID")) %>%
  left_join(CEWL_avg, by = "individual_ID")
```


### Join Differently 

```{r}
CEWL_plus <- CEWL %>%
  left_join(morpho_blood_dat, by = c("date", "individual_ID")
            )
```




# Data Cleaning


## Histograms

example code that will not work as-is:

```{r}
CEWL_rep_avg %>% #dataframe
  ggplot(., aes(x = TEWL_CV)) + # set up 
  geom_histogram(color = "black", fill="steelblue", bins=50) + # plot type
  theme_classic() + # make pretty
  xlab("Coefficient of Variation") + 
  ylab("Count") +
  labs(title = "All Three Replicates")
```



# Basic Figures

## Hct ~ SVL

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = hematocrit_percent, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = SVL_mm, 
                  y = hematocrit_percent, 
                  #color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("Hct") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```



## Osml ~ SVL

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = osmolality_mmol_kg, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = SVL_mm, 
                  y = osmolality_mmol_kg, 
                  #color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```


## Hematocrit ~ Mass

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = hematocrit_percent, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = mass_g, 
                  y = hematocrit_percent, 
                  #color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```

## Osml ~ Mass

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = osmolality_mmol_kg, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = mass_g, 
                  y = osmolality_mmol_kg), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "gray",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```


## Hct ~ Sex

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = hematocrit_percent, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Sex", 
                      #labels = c("Shrubbed", "Shrubless"), 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```



## Osml ~ Sex

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = osmolality_mmol_kg, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Sex", 
                      #labels = c("Shrubbed", "Shrubless"), 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```



# Important Figures


## CEWL ~ Body Region


```{r}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = region, 
                   y = TEWL_g_m2h, 
                   color = region
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_color_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  scale_x_discrete(labels = c("Dewlap", "Dorsum", "Head",
                              "Mite Patch", "Ventrum")) +
  theme_classic() + 
  xlab("Body Region") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```


## All CEWL ~ Osml

```{r}
CEWL_plus %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```

## Dorsum CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = dorsum_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = dorsum_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "lightblue4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Dorsum CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```



## Ventrum CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = ventrum_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = ventrum_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "seashell4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Ventrum CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```



## Dewlap CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = dewlap_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = dewlap_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "palegreen4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Dewlap CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```



## Mite Patch CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = mitepatch_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = mitepatch_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "lightpink3") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Mite Patch CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```


## Head CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = head_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = head_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "plum4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Head CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```


## CEWL ~ Week

```{r}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = week, 
                   y = TEWL_g_m2h, 
                   color = week
                   ), 
               size = 1,
               alpha = 0.6) + 
  facet_wrap(~region) + # could not figure out how to change facet labels without changing underlying data
  scale_color_manual(values = c("royalblue1", "mediumorchid", "seagreen4")) +
  scale_x_discrete(breaks = c(1,2,3)) +
  theme_classic() + 
  xlab("Week") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```




# Weather Data






# Models

example that will not work as-is:

```{r, models}
mod4 <- nlme::lme(data = CEWL_sub, # dataframe
                  TEWL_g_m2h ~ replicate, # DV ~ IV
                  random = ~ 1|ID # random effects that are not IVs of interest
                  ) 
summary(mod4)
```



   
# PCA













# Ideas


a.	CEWL ~ body mass & CEWL ~ SVL  Do we need to correct for size, or do we avoid this by measuring local CEWL instead of TEWL?
b.	Calculate estimates of TEWL based on equations presented in (6).  How much do the estimates vary depending on which CEWL we use? Can we figure out how to use all of our different CEWL measurements to calculate what we think would be an accurate TEWL?
c.	Singular GLMs with 1-2 independent variables:
i.	CEWL ~ body region
1.	All tests will include body region since this is our primary a priori hypothesis.
ii.	CEWL ~ body region + blood osmolarity
iii.	CEWL ~ body region + hematocrit
iv.	CEWL ~ body region + cloacal temperature
v.	CEWL ~ body region + ambient temperature 
vi.	CEWL ~ body region + ambient humidity
vii.	CEWL ~ body region + sex
viii.	CEWL ~ body region + gravidity
ix.	CEWL ~ body region + number of eggs
x.	CEWL ~ body region + individual ID
d.	Multiple regression GLM:
i.	CEWL ~ fixed effects: body region, blood osmolarity, hematocrit, body mass, SVL, sex, gravidity, number of eggs; likely random effect: ID
ii.	Model selection





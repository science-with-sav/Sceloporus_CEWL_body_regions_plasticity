---
title: "Cal Poly Herpetology CURE - Baseline Analyses"
authors: "Savannah Weaver, Dylan Stephens, Jenna Heaphy"
date: "Spring Quarter 2021"
output: github_document
---


# Rules :)

1. Write blurbs before/after code chunks to explain wtf it is and why helpful/important. For example, listing variables (otherwise I've done a poor job with this on this Rmd).
2. Comment on your code, especially to point out what doesn't work, questions you have, or uncertainties.
3. No deleting other peoples work! You can delete your own as you work on it, but otherwise keep everything. You can keep versions of things (with notes explaining that!). I may delete versions that become irrelevant, but often code will become helpful later.


# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")
if (!require("UsingR")) install.packages("UsingR")
```

## ggbiplot
```{r}
# 
#  ggbiplot.r
#  
#  Copyright 2011 Vincent Q. Vu.
# 
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of the GNU General Public License
#  as published by the Free Software Foundation; either version 2
#  of the License, or (at your option) any later version.
#  
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#  
#  You should have received a copy of the GNU General Public License
#  along with this program; if not, write to the Free Software
#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
# 

#' Biplot for Principal Components using ggplot2
#'
#' @param pcobj           an object returned by prcomp() or princomp()
#' @param choices         which PCs to plot
#' @param scale           covariance biplot (scale = 1), form biplot (scale = 0). When scale = 1, the inner product between the variables approximates the covariance and the distance between the points approximates the Mahalanobis distance.
#' @param obs.scale       scale factor to apply to observations
#' @param var.scale       scale factor to apply to variables
#' @param pc.biplot       for compatibility with biplot.princomp()
#' @param groups          optional factor variable indicating the groups that the observations belong to. If provided the points will be colored according to groups
#' @param ellipse         draw a normal data ellipse for each group?
#' @param ellipse.prob    size of the ellipse in Normal probability
#' @param labels          optional vector of labels for the observations
#' @param labels.size     size of the text used for the labels
#' @param alpha           alpha transparency value for the points (0 = transparent, 1 = opaque)
#' @param circle          draw a correlation circle? (only applies when prcomp was called with scale = TRUE and when var.scale = 1)
#' @param var.axes        draw arrows for the variables?
#' @param varname.size    size of the text for variable names
#' @param varname.adjust  adjustment factor the placement of the variable names, >= 1 means farther from the arrow
#' @param varname.abbrev  whether or not to abbreviate the variable names
#'
#' @return                a ggplot2 plot
#' @export
#' @examples
#'   data(wine)
#'   wine.pca <- prcomp(wine, scale. = TRUE)
#'   print(ggbiplot(wine.pca, obs.scale = 1, var.scale = 1, groups = wine.class, ellipse = TRUE, circle = TRUE))
#'
ggbiplot <- function(pcobj, choices = 1:2, scale = 1, pc.biplot = TRUE, 
                     obs.scale = 1 - scale, var.scale = scale, 
                     groups = NULL, ellipse = FALSE, ellipse.prob = 0.68, 
                     labels = NULL, labels.size = 3, alpha = 1, 
                     var.axes = TRUE, 
                     circle = FALSE, circle.prob = 0.69, 
                     varname.size = 3, varname.adjust = 1.5, 
                     varname.abbrev = FALSE, ...)
{
  library(ggplot2)
  library(plyr)
  library(scales)
  library(grid)
  
  stopifnot(length(choices) == 2)
  
  # Recover the SVD
  if(inherits(pcobj, 'prcomp')){
    nobs.factor <- sqrt(nrow(pcobj$x) - 1)
    d <- pcobj$sdev
    u <- sweep(pcobj$x, 2, 1 / (d * nobs.factor), FUN = '*')
    v <- pcobj$rotation
  } else if(inherits(pcobj, 'princomp')) {
    nobs.factor <- sqrt(pcobj$n.obs)
    d <- pcobj$sdev
    u <- sweep(pcobj$scores, 2, 1 / (d * nobs.factor), FUN = '*')
    v <- pcobj$loadings
  } else if(inherits(pcobj, 'PCA')) {
    nobs.factor <- sqrt(nrow(pcobj$call$X))
    d <- unlist(sqrt(pcobj$eig)[1])
    u <- sweep(pcobj$ind$coord, 2, 1 / (d * nobs.factor), FUN = '*')
    v <- sweep(pcobj$var$coord,2,sqrt(pcobj$eig[1:ncol(pcobj$var$coord),1]),FUN="/")
  } else if(inherits(pcobj, "lda")) {
    nobs.factor <- sqrt(pcobj$N)
    d <- pcobj$svd
    u <- predict(pcobj)$x/nobs.factor
    v <- pcobj$scaling
    d.total <- sum(d^2)
  } else {
    stop('Expected a object of class prcomp, princomp, PCA, or lda')
  }
  
  # Scores
  choices <- pmin(choices, ncol(u))
  df.u <- as.data.frame(sweep(u[,choices], 2, d[choices]^obs.scale, FUN='*'))
  
  # Directions
  v <- sweep(v, 2, d^var.scale, FUN='*')
  df.v <- as.data.frame(v[, choices])
  
  names(df.u) <- c('xvar', 'yvar')
  names(df.v) <- names(df.u)
  
  if(pc.biplot) {
    df.u <- df.u * nobs.factor
  }
  
  # Scale the radius of the correlation circle so that it corresponds to 
  # a data ellipse for the standardized PC scores
  r <- sqrt(qchisq(circle.prob, df = 2)) * prod(colMeans(df.u^2))^(1/4)
  
  # Scale directions
  v.scale <- rowSums(v^2)
  df.v <- r * df.v / sqrt(max(v.scale))
  
  # Change the labels for the axes
  if(obs.scale == 0) {
    u.axis.labs <- paste('standardized PC', choices, sep='')
  } else {
    u.axis.labs <- paste('PC', choices, sep='')
  }
  
  # Append the proportion of explained variance to the axis labels
  u.axis.labs <- paste(u.axis.labs, 
                       sprintf('(%0.1f%% explained var.)', 
                               100 * pcobj$sdev[choices]^2/sum(pcobj$sdev^2)))
  
  # Score Labels
  if(!is.null(labels)) {
    df.u$labels <- labels
  }
  
  # Grouping variable
  if(!is.null(groups)) {
    df.u$groups <- groups
  }
  
  # Variable Names
  if(varname.abbrev) {
    df.v$varname <- abbreviate(rownames(v))
  } else {
    df.v$varname <- rownames(v)
  }
  
  # Variables for text label placement
  df.v$angle <- with(df.v, (180/pi) * atan(yvar / xvar))
  df.v$hjust = with(df.v, (1 - varname.adjust * sign(xvar)) / 2)
  
  # Base plot
  g <- ggplot(data = df.u, aes(x = xvar, y = yvar)) + 
    xlab(u.axis.labs[1]) + ylab(u.axis.labs[2]) + coord_equal()
  
  if(var.axes) {
    # Draw circle
    if(circle) 
    {
      theta <- c(seq(-pi, pi, length = 50), seq(pi, -pi, length = 50))
      circle <- data.frame(xvar = r * cos(theta), yvar = r * sin(theta))
      g <- g + geom_path(data = circle, color = muted('white'), 
                         size = 1/2, alpha = 1/3)
    }
    
    # Draw directions
    g <- g +
      geom_segment(data = df.v,
                   aes(x = 0, y = 0, xend = xvar, yend = yvar),
                   arrow = arrow(length = unit(1/2, 'picas')), 
                   color = muted('red'))
  }
  
  # Draw either labels or points
  if(!is.null(df.u$labels)) {
    if(!is.null(df.u$groups)) {
      g <- g + geom_text(aes(label = labels, color = groups), 
                         size = labels.size)
    } else {
      g <- g + geom_text(aes(label = labels), size = labels.size)      
    }
  } else {
    if(!is.null(df.u$groups)) {
      g <- g + geom_point(aes(color = groups), alpha = alpha)
    } else {
      g <- g + geom_point(alpha = alpha)      
    }
  }
  
  # Overlay a concentration ellipse if there are groups
  if(!is.null(df.u$groups) && ellipse) {
    theta <- c(seq(-pi, pi, length = 50), seq(pi, -pi, length = 50))
    circle <- cbind(cos(theta), sin(theta))
    
    ell <- ddply(df.u, 'groups', function(x) {
      if(nrow(x) <= 2) {
        return(NULL)
      }
      sigma <- var(cbind(x$xvar, x$yvar))
      mu <- c(mean(x$xvar), mean(x$yvar))
      ed <- sqrt(qchisq(ellipse.prob, df = 2))
      data.frame(sweep(circle %*% chol(sigma) * ed, 2, mu, FUN = '+'), 
                 groups = x$groups[1])
    })
    names(ell)[1:2] <- c('xvar', 'yvar')
    g <- g + geom_path(data = ell, aes(color = groups, group = groups))
  }
  
  # Label the variable axes
  if(var.axes) {
    g <- g + 
      geom_text(data = df.v, 
                aes(label = varname, x = xvar, y = yvar, 
                    angle = angle, hjust = hjust), 
                color = 'darkred', size = varname.size)
  }
  # Change the name of the legend for groups
  # if(!is.null(groups)) {
  #   g <- g + scale_color_brewer(name = deparse(substitute(groups)), 
  #                               palette = 'Dark2')
  # }
  
  # TODO: Add a second set of axes
  
  return(g)
}
```



# Data

### Morphometrics and Blood Data

variables:
- date
- collection/capture time for each lizard
- individual ID for each lizard
- sock ID used to capture each lizard
- SVL = snout-vent length
- mass in grams
- sex
- if female, whether or not gravid
- which eye the blood sample was taken from
- percent hematocrit = percent of blood that's red blood cells
- osmolality = a proxy of hydration, should be inversely related to water content of a lizard (this is the average of 1-3 replicates)
- cloacal temperature at the time of CEWL measurement
- processing time for each lizard, when all measurements were finished
- hemolyzed whether or not red blood cells burst and contaminated plasma

```{r morpho blood data}
morpho_blood_dat <- read.csv("./data/Herpetology_Data.csv",
                             na.strings=c("","NA") # fix empty cells
                             ) %>%
  dplyr::mutate(date = as.Date(date, format = "%m/%d/%y"),
                collect_time = as.POSIXct(collect_time, format = "%H:%M"),
                processing_time = as.POSIXct(processing_time, format = "%H:%M"),
                sex_M_F = as.factor(sex_M_F),
                gravid_Y_N = as.factor(gravid_Y_N),
                blood_sample_eye = as.factor(blood_sample_eye),
                hemolyzed. = as.factor(hemolyzed.),
                individual_ID = as.character(individual_ID)
                ) %>%
  dplyr::filter(osmolality_mmol_kg <= 500) # remove one point I think inaccurate
summary(morpho_blood_dat)
```


### CEWL Data

```{r CEWL data}
# week 1
CEWL_April_05 <- read.csv("./data/capture_CEWL/4-5-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::mutate(week = "1") %>% # add weekend index for throughout season
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH...., # rename
                week
                )

# week 2
CEWL_April_19 <- read.csv("./data/capture_CEWL/4-19-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::mutate(week = "2") %>% # add weekend index for throughout season
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH...., # rename
                week
                )

# week 3
CEWL_April_26 <- read.csv("./data/capture_CEWL/4-26-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::mutate(week = "3") %>% # add weekend index for throughout season
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH...., # rename
                week
                )

# merge all CEWL datafiles & reformat
CEWL <- CEWL_April_05 %>%
  # join
  rbind(., CEWL_April_19, CEWL_April_26) %>%
  # remove any unsuccessful measurements
  dplyr::filter(Status == "Normal") %>%
  # reformat data
  dplyr::mutate(date_time = as.POSIXct(paste(date, Time), format = "%m/%d/%y %I:%M:%S %p"),
                # date only
                date = as.Date(date, format = "%m/%d/%y"),
                # time with arbitrary date, need to figure out how to remove
                Time = as.POSIXct(Time, format = "%I:%M:%S %p"),
                # extract individual ID number
                individual_ID = as.numeric(substring(ID, 1, 2)),
                # extract body region for CEWL measurement
                region = as.factor(substring(ID, 4, 7)),
                week = as.factor(week),
                individual_ID = as.character(individual_ID)
                ) %>%
  dplyr::select(-ID, -Status
                ) %>%
  dplyr::filter(complete.cases(.))
summary(CEWL)
unique(CEWL$region)
```


### Split CEWL Data

```{r}
# select each CEWL region separately 
CEWL_dorsum <- CEWL %>%
  dplyr::filter(region == "dors") %>%
  dplyr::select(date, individual_ID, 
                dorsum_TEWL_g_m2h = TEWL_g_m2h)
CEWL_ventrum <- CEWL %>%
  dplyr::filter(region == "vent") %>%
  dplyr::select(date, individual_ID, 
                ventrum_TEWL_g_m2h = TEWL_g_m2h)
CEWL_dewlap <- CEWL %>%
  dplyr::filter(region == "dewl") %>%
  dplyr::select(date, individual_ID, 
                dewlap_TEWL_g_m2h = TEWL_g_m2h)
CEWL_head <- CEWL %>%
  dplyr::filter(region == "head") %>%
  dplyr::select(date, individual_ID, 
                head_TEWL_g_m2h = TEWL_g_m2h)
CEWL_mitepatch <- CEWL %>%
  dplyr::filter(region == "mite") %>%
  dplyr::select(date, individual_ID, 
                mitepatch_TEWL_g_m2h = TEWL_g_m2h)

# also get average across body regions
CEWL_avg <- CEWL %>%
  group_by(individual_ID) %>%
  summarise(avg_CEWL = mean(TEWL_g_m2h)) %>%
  dplyr::select(individual_ID, avg_CEWL)
```


### Rearrange and Join

```{r join data}
# join all CEWL regions to morpho and blood data
data_full <- morpho_blood_dat %>%
  left_join(CEWL_dorsum, by = c("date", "individual_ID")) %>%
  left_join(CEWL_ventrum, by = c("date", "individual_ID")) %>%
  left_join(CEWL_dewlap, by = c("date", "individual_ID")) %>%
  left_join(CEWL_head, by = c("date", "individual_ID")) %>%
  left_join(CEWL_mitepatch, by = c("date", "individual_ID")) %>%
  left_join(CEWL_avg, by = "individual_ID")
```


### Join Differently 

```{r}
CEWL_plus <- CEWL %>%
  left_join(morpho_blood_dat, by = c("date", "individual_ID")
            )
```




# Data Cleaning


## Histograms

example code that will not work as-is:

```{r}
CEWL_rep_avg %>% #dataframe
  ggplot(., aes(x = TEWL_CV)) + # set up 
  geom_histogram(color = "black", fill="steelblue", bins=50) + # plot type
  theme_classic() + # make pretty
  xlab("Coefficient of Variation") + 
  ylab("Count") +
  labs(title = "All Three Replicates")
```



# Basic Figures

## Hct ~ SVL

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = hematocrit_percent, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = SVL_mm, 
                  y = hematocrit_percent, 
                  #color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("Hct") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```



## Osml ~ SVL

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = osmolality_mmol_kg, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = SVL_mm, 
                  y = osmolality_mmol_kg, 
                  #color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```


## Hematocrit ~ Mass

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = hematocrit_percent, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = mass_g, 
                  y = hematocrit_percent, 
                  #color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```

## Osml ~ Mass

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = osmolality_mmol_kg, 
                 #color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) + 
  #scale_colour_manual(name = "Treatment", 
   #                   #labels = c("Burrow", "Open", "Shrub"), 
    #                  values = c("salmon1", "royalblue") ) +
  #scale_shape_discrete(name = "Microhabitat", 
   #                    labels = c("Burrow", "Open", "Shrub") ) + 
  stat_smooth(aes(x = mass_g, 
                  y = osmolality_mmol_kg), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "gray",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```


## Hct ~ Sex

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = hematocrit_percent, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Sex", 
                      #labels = c("Shrubbed", "Shrubless"), 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```



## Osml ~ Sex

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = osmolality_mmol_kg, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Sex", 
                      #labels = c("Shrubbed", "Shrubless"), 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```



# Important Figures


## CEWL ~ Body Region


```{r}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = region, 
                   y = TEWL_g_m2h, 
                   color = region
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_color_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  scale_x_discrete(labels = c("Dewlap", "Dorsum", "Head",
                              "Mite Patch", "Ventrum")) +
  theme_classic() + 
  xlab("Body Region") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```


## All CEWL ~ Osml

```{r}
CEWL_plus %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
        #legend.position = c(0.9, 0.145)
)
```

## Dorsum CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = dorsum_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = dorsum_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "lightblue4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Dorsum CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```



## Ventrum CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = ventrum_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = ventrum_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "seashell4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Ventrum CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```



## Dewlap CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = dewlap_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = dewlap_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "palegreen4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Dewlap CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```



## Mite Patch CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = mitepatch_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = mitepatch_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "lightpink3") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Mite Patch CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```


## Head CEWL ~ Osmolality 

```{r}
data_full %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = head_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = head_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "plum4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Head CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)
```


## CEWL ~ Week

```{r}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = week, 
                   y = TEWL_g_m2h, 
                   color = week
                   ), 
               size = 1,
               alpha = 0.6) + 
  facet_wrap(~region) + # could not figure out how to change facet labels without changing underlying data
  scale_color_manual(values = c("royalblue1", "mediumorchid", "seagreen4")) +
  scale_x_discrete(breaks = c(1,2,3)) +
  theme_classic() + 
  xlab("Week") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)
```




# Weather Data

Acess data to weather
http://www.itrc.org/databases/precip/


# Models

example that will not work as-is:

```{r, models}
mod4 <- nlme::lme(data = CEWL_sub, # dataframe
                  TEWL_g_m2h ~ replicate, # DV ~ IV
                  random = ~ 1|ID # random effects that are not IVs of interest
                  ) 
summary(mod4)
```



# PCA
```{r}

## Subset data
sub_data_full <- data_full[,c(5:7,10,11,12, 14, 16:20)]

## Remove NA
sub_data_full <- na.omit(sub_data_full)

## Numeric and List of Categorical
names(sub_data_full)
data_num_loc <- sub_data_full[, c(8:12)]
data_num_exp <- sub_data_full[, c(1,2,4:6)]

sex_list_sub <- sub_data_full$sex_M_F

## Create PCAs
#### CEWL all locations PCA
data.pca <- prcomp(data_num_loc, center=T, scale. = T)
summary(data.pca)
str(data.pca)
#### CEWL avg PCA
data2.pca <- prcomp(data_num_exp, center=T, scale. = T)
summary(data2.pca)
str(data2.pca)

## Plots
### CEWL all locations, gender groups
ggbiplot(data.pca, labels=rownames(data.pca), ellipse=T, groups=sex_list_sub)

### CEWL avg, gender groups
ggbiplot(data2.pca, labels=rownames(data.pca), ellipse=T, groups=sex_list_sub)

### CEWL locations PCA 3 and $
ggbiplot(data.pca, labels=rownames(data.pca), ellipse=T, choices= c(3,4), groups=sex_list_sub)
```


# Ideas


a.	CEWL ~ body mass & CEWL ~ SVL  Do we need to correct for size, or do we avoid this by measuring local CEWL instead of TEWL?
b.	Calculate estimates of TEWL based on equations presented in (6).  How much do the estimates vary depending on which CEWL we use? Can we figure out how to use all of our different CEWL measurements to calculate what we think would be an accurate TEWL?
c.	Singular GLMs with 1-2 independent variables:
i.	CEWL ~ body region
1.	All tests will include body region since this is our primary a priori hypothesis.
ii.	CEWL ~ body region + blood osmolarity
iii.	CEWL ~ body region + hematocrit
iv.	CEWL ~ body region + cloacal temperature
v.	CEWL ~ body region + ambient temperature 
vi.	CEWL ~ body region + ambient humidity
vii.	CEWL ~ body region + sex
viii.	CEWL ~ body region + gravidity
ix.	CEWL ~ body region + number of eggs
x.	CEWL ~ body region + individual ID
d.	Multiple regression GLM:
i.	CEWL ~ fixed effects: body region, blood osmolarity, hematocrit, body mass, SVL, sex, gravidity, number of eggs; likely random effect: ID
ii.	Model selection





---
title: "Cal Poly Herpetology CURE - Baseline Analyses"
authors: "Savannah Weaver & Dylan Stephens"
date: "Spring Quarter 2021"
output: github_document
---

# to-do
- name each code chunk

# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse") # workflow and plots
if (!require("zoo")) install.packages("zoo")
library("zoo") # interpolation using na.approx
if (!require("weathermetrics")) install.packages("weathermetrics")
library("weathermetrics") # F to C conversion
if (!require("PerformanceAnalytics")) install.packages("PerformanceAnalytics") 
library("PerformanceAnalytics") # pretty multicollinearity plots
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
if (!require("MASS")) install.packages("MASS")
library("MASS") # model selection
if (!require("nlme")) install.packages("nlme")
library("nlme") # for GLMMs
if (!require("visreg")) install.packages("visreg")
library("visreg") # plot models
```


# Background and Goals

This data was collected April - May 2021 during a course-based undergraduate research experience (CURE) in Herpetology, taught by Emily Taylor at Cal Poly, San Luis Obispo. This part of the study was conducted to describe the variation in hydrophysiology in *Sceloporus occidentalis* and to investigate that drives that variation. Please refer to **doi:** for full details.

In this document, we investigate differences in cutaneous evaporative water loss (CEWL) across body regions and dependent on environment, body size, health, and hydration. 


# ggbiplot

I'm not sure what to apply this to? - Savannah

Principle Component Analyses Plots - Dylan


```{r}
# 
#  ggbiplot.r
#  
#  Copyright 2011 Vincent Q. Vu.
# 
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of the GNU General Public License
#  as published by the Free Software Foundation; either version 2
#  of the License, or (at your option) any later version.
#  
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#  
#  You should have received a copy of the GNU General Public License
#  along with this program; if not, write to the Free Software
#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
# 

#' Biplot for Principal Components using ggplot2
#'
#' @param pcobj           an object returned by prcomp() or princomp()
#' @param choices         which PCs to plot
#' @param scale           covariance biplot (scale = 1), form biplot (scale = 0). When scale = 1, the inner product between the variables approximates the covariance and the distance between the points approximates the Mahalanobis distance.
#' @param obs.scale       scale factor to apply to observations
#' @param var.scale       scale factor to apply to variables
#' @param pc.biplot       for compatibility with biplot.princomp()
#' @param groups          optional factor variable indicating the groups that the observations belong to. If provided the points will be colored according to groups
#' @param ellipse         draw a normal data ellipse for each group?
#' @param ellipse.prob    size of the ellipse in Normal probability
#' @param labels          optional vector of labels for the observations
#' @param labels.size     size of the text used for the labels
#' @param alpha           alpha transparency value for the points (0 = transparent, 1 = opaque)
#' @param circle          draw a correlation circle? (only applies when prcomp was called with scale = TRUE and when var.scale = 1)
#' @param var.axes        draw arrows for the variables?
#' @param varname.size    size of the text for variable names
#' @param varname.adjust  adjustment factor the placement of the variable names, >= 1 means farther from the arrow
#' @param varname.abbrev  whether or not to abbreviate the variable names
#'
#' @return                a ggplot2 plot
#' @export
#' @examples
#'   data(wine)
#'   wine.pca <- prcomp(wine, scale. = TRUE)
#'   print(ggbiplot(wine.pca, obs.scale = 1, var.scale = 1, groups = wine.class, ellipse = TRUE, circle = TRUE))
#'
ggbiplot <- function(pcobj, choices = 1:2, scale = 1, pc.biplot = TRUE, 
                     obs.scale = 1 - scale, var.scale = scale, 
                     groups = NULL, ellipse = FALSE, ellipse.prob = 0.68, 
                     labels = NULL, labels.size = 3, alpha = 1, 
                     var.axes = TRUE, 
                     circle = FALSE, circle.prob = 0.69, 
                     varname.size = 3, varname.adjust = 1.5, 
                     varname.abbrev = FALSE, ...)
{
  library(ggplot2)
  library(plyr)
  library(scales)
  library(grid)
  
  stopifnot(length(choices) == 2)
  
  # Recover the SVD
  if(inherits(pcobj, 'prcomp')){
    nobs.factor <- sqrt(nrow(pcobj$x) - 1)
    d <- pcobj$sdev
    u <- sweep(pcobj$x, 2, 1 / (d * nobs.factor), FUN = '*')
    v <- pcobj$rotation
  } else if(inherits(pcobj, 'princomp')) {
    nobs.factor <- sqrt(pcobj$n.obs)
    d <- pcobj$sdev
    u <- sweep(pcobj$scores, 2, 1 / (d * nobs.factor), FUN = '*')
    v <- pcobj$loadings
  } else if(inherits(pcobj, 'PCA')) {
    nobs.factor <- sqrt(nrow(pcobj$call$X))
    d <- unlist(sqrt(pcobj$eig)[1])
    u <- sweep(pcobj$ind$coord, 2, 1 / (d * nobs.factor), FUN = '*')
    v <- sweep(pcobj$var$coord,2,sqrt(pcobj$eig[1:ncol(pcobj$var$coord),1]),FUN="/")
  } else if(inherits(pcobj, "lda")) {
    nobs.factor <- sqrt(pcobj$N)
    d <- pcobj$svd
    u <- predict(pcobj)$x/nobs.factor
    v <- pcobj$scaling
    d.total <- sum(d^2)
  } else {
    stop('Expected a object of class prcomp, princomp, PCA, or lda')
  }
  
  # Scores
  choices <- pmin(choices, ncol(u))
  df.u <- as.data.frame(sweep(u[,choices], 2, d[choices]^obs.scale, FUN='*'))
  
  # Directions
  v <- sweep(v, 2, d^var.scale, FUN='*')
  df.v <- as.data.frame(v[, choices])
  
  names(df.u) <- c('xvar', 'yvar')
  names(df.v) <- names(df.u)
  
  if(pc.biplot) {
    df.u <- df.u * nobs.factor
  }
  
  # Scale the radius of the correlation circle so that it corresponds to 
  # a data ellipse for the standardized PC scores
  r <- sqrt(qchisq(circle.prob, df = 2)) * prod(colMeans(df.u^2))^(1/4)
  
  # Scale directions
  v.scale <- rowSums(v^2)
  df.v <- r * df.v / sqrt(max(v.scale))
  
  # Change the labels for the axes
  if(obs.scale == 0) {
    u.axis.labs <- paste('standardized PC', choices, sep='')
  } else {
    u.axis.labs <- paste('PC', choices, sep='')
  }
  
  # Append the proportion of explained variance to the axis labels
  u.axis.labs <- paste(u.axis.labs, 
                       sprintf('(%0.1f%% explained var.)', 
                               100 * pcobj$sdev[choices]^2/sum(pcobj$sdev^2)))
  
  # Score Labels
  if(!is.null(labels)) {
    df.u$labels <- labels
  }
  
  # Grouping variable
  if(!is.null(groups)) {
    df.u$groups <- groups
  }
  
  # Variable Names
  if(varname.abbrev) {
    df.v$varname <- abbreviate(rownames(v))
  } else {
    df.v$varname <- rownames(v)
  }
  
  # Variables for text label placement
  df.v$angle <- with(df.v, (180/pi) * atan(yvar / xvar))
  df.v$hjust = with(df.v, (1 - varname.adjust * sign(xvar)) / 2)
  
  # Base plot
  g <- ggplot(data = df.u, aes(x = xvar, y = yvar)) + 
    xlab(u.axis.labs[1]) + ylab(u.axis.labs[2]) + coord_equal()
  
  if(var.axes) {
    # Draw circle
    if(circle) 
    {
      theta <- c(seq(-pi, pi, length = 50), seq(pi, -pi, length = 50))
      circle <- data.frame(xvar = r * cos(theta), yvar = r * sin(theta))
      g <- g + geom_path(data = circle, color = muted('white'), 
                         size = 1/2, alpha = 1/3)
    }
    
    # Draw directions
    g <- g +
      geom_segment(data = df.v,
                   aes(x = 0, y = 0, xend = xvar, yend = yvar),
                   arrow = arrow(length = unit(1/2, 'picas')), 
                   color = muted('red'))
  }
  
  # Draw either labels or points
  if(!is.null(df.u$labels)) {
    if(!is.null(df.u$groups)) {
      g <- g + geom_text(aes(label = labels, color = groups), 
                         size = labels.size)
    } else {
      g <- g + geom_text(aes(label = labels), size = labels.size)      
    }
  } else {
    if(!is.null(df.u$groups)) {
      g <- g + geom_point(aes(color = groups), alpha = alpha)
    } else {
      g <- g + geom_point(alpha = alpha)      
    }
  }
  
  # Overlay a concentration ellipse if there are groups
  if(!is.null(df.u$groups) && ellipse) {
    theta <- c(seq(-pi, pi, length = 50), seq(pi, -pi, length = 50))
    circle <- cbind(cos(theta), sin(theta))
    
    ell <- ddply(df.u, 'groups', function(x) {
      if(nrow(x) <= 2) {
        return(NULL)
      }
      sigma <- var(cbind(x$xvar, x$yvar))
      mu <- c(mean(x$xvar), mean(x$yvar))
      ed <- sqrt(qchisq(ellipse.prob, df = 2))
      data.frame(sweep(circle %*% chol(sigma) * ed, 2, mu, FUN = '+'), 
                 groups = x$groups[1])
    })
    names(ell)[1:2] <- c('xvar', 'yvar')
    g <- g + geom_path(data = ell, aes(color = groups, group = groups))
  }
  
  # Label the variable axes
  if(var.axes) {
    g <- g + 
      geom_text(data = df.v, 
                aes(label = varname, x = xvar, y = yvar, 
                    angle = angle, hjust = hjust), 
                color = 'darkred', size = varname.size)
  }
  # Change the name of the legend for groups
  # if(!is.null(groups)) {
  #   g <- g + scale_color_brewer(name = deparse(substitute(groups)), 
  #                               palette = 'Dark2')
  # }
  
  # TODO: Add a second set of axes
  
  return(g)
}
```


# Data

### Morphometrics and Blood Data

This data was collected upon capture of each lizard.

Variables in this dataframe:
- date
- collection/capture time for each lizard
- individual ID for each lizard
- sock ID used to capture each lizard (removed, not relevant to analyses)
- SVL = snout-vent length
- mass in grams
- sex
- if female, whether or not gravid (with eggs)
- which eye the blood sample was taken from
- percent hematocrit = percent of blood that's red blood cells
- osmolality = a proxy of hydration, should be inversely related to water content of a lizard (this is the average of 1-3 replicates)
- cloacal temperature at the time of CEWL measurement
- processing time for each lizard, when all measurements were finished
- hemolyzed = whether or not red blood cells burst and contaminated plasma

Before loading in this data, some incorrectly-measured hematocrit and osmolality were omitted:
- hematocrit for individuals 1-16, due to observer error
- osmolality for individual 19, due to instrumental error

```{r morpho blood data}
# load and format data
morpho_blood_dat <- read.csv("./data/Herpetology_Data.csv", # filename
                             na.strings=c("","NA") # fix empty cells
                             ) %>%
  dplyr::mutate(# put date and time together
                collect_date_time = (paste(date, collect_time)), 
                # replace some date-time values that have missing times
                collect_date_time = replace(collect_date_time, 
                                            collect_date_time == "4/5/21 NA", NA),
                # correctly format date-time variable
                collect_date_time = as.POSIXct(collect_date_time, 
                                               format = "%m/%d/%y %H:%M"),
                # correctly format date-only variable
                date = as.Date(date, format = "%m/%d/%y"),
                # correctly format collection time variable
                # format extracts just time after posix adds arbitrary date
                collect_time = format(as.POSIXct(collect_time, 
                                                 format = "%H:%M"),
                                      format = "%H:%M"),
                # correctly format processing time variable
                processing_time = format(as.POSIXct(processing_time, 
                                                    format = "%H:%M"), 
                                         format = "%H:%M"),
                # set sex variable as a factor, not character
                sex_M_F = as.factor(sex_M_F),
                # set gravidity variable as a factor, not character
                gravid_Y_N = as.factor(gravid_Y_N),
                # set blood sample eye variable as a factor, not character
                blood_sample_eye = as.factor(blood_sample_eye),
                # set hemolyzed variable as a factor, not character
                hemolyzed = as.factor(hemolyzed)
                ) %>%
  # remove two columns not relevant for statistics
  dplyr::select(-sock_ID, -notes)
summary(morpho_blood_dat)
```

I want to test if any IDs are missing, and which they are.

```{r}
test <- c(seq(1, 150, by = 1))
lost <- test[test %nin% morpho_blood_dat$individual_ID]
lost
```

Individuals 23 and 56 actually both do not exist because those numbers were skipped when assigning IDs, so we have all the individuals measured in the dataframe.


### CEWL Data

First, load it all in and merge.

Variables in this dataframe are:
- date
- time
- date_time combined variable
- individual_ID for each lizard measured
- region = where on the body CEWL was measured
- TEWL_g_m2h = CEWL measurement value in grams/sq-meter/hour
- CV = coefficient of variation of the measurements immediately before the final measurement
- SSWL_g_m2 = ?
- ambient_temp_C = temperature when and where measurement was taken
- ambient_RH_percent = relative humidity when and where measurement was taken

```{r CEWL data}
# week 1
CEWL_April_05 <- read.csv("./data/capture_CEWL/4-5-21-CEWL.csv", # filename
                          na.strings=c("","NA")) %>% # fix empty cells
  # rename and select the pertinent variables/cols
  # I have to do this for each one 
  # so they all have the same number of columns for joining
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH....
                )

# week 2
CEWL_April_19 <- read.csv("./data/capture_CEWL/4-19-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH....
                )

# week 3
CEWL_April_26 <- read.csv("./data/capture_CEWL/4-26-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH....
                )

# week 4
CEWL_May_3 <- read.csv("./data/capture_CEWL/5-3-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH....
                )

# week 5
CEWL_May_10 <- read.csv("./data/capture_CEWL/5-10-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH....
                )

# week 6
CEWL_May_17 <- read.csv("./data/capture_CEWL/5-17-21-CEWL.csv",
                          na.strings=c("","NA")) %>%
  dplyr::select(date = Date, 
                Time, Status,
                ID = Comments,
                TEWL_g_m2h = TEWL..g..m2h.., # rename
                CV = CV...., # rename
                SSWL_g_m2 = SSWL..g..m2.., # rename
                ambient_temp_C = AmbT..C., # rename
                ambient_RH_percent = AmbRH....
                )

# merge all CEWL datafiles & reformat
CEWL <- CEWL_April_05 %>% # week 1
  # join with weeks 2-6
  rbind(., CEWL_April_19, 
        CEWL_April_26,
        CEWL_May_3,
        CEWL_May_10,
        CEWL_May_17
        ) %>%
  # remove any unsuccessful measurements
  dplyr::filter(Status == "Normal") %>%
  # extract individual_ID and region separately from the "ID" variable
  separate(ID, c("individual_ID", "region")) %>%
  # reformat data
  dplyr::mutate(# paste and format date-time variable
                CEWL_date_time = as.POSIXct(paste(date, Time), 
                                            format = "%m/%d/%y %I:%M:%S %p"),
                # reformat date only
                date = as.Date(date, format = "%m/%d/%y"),
                # reformat time 
                # format extracts just time after posix adds arbitrary date
                # but then it's a character again... 
                Time = format(as.POSIXct(Time, format = "%I:%M:%S %p"), 
                              format = "%H:%M:%S"),
                # format individual ID as a number
                individual_ID = as.numeric(individual_ID),
                # set body region as a factor variable after getting only the consistent characters due to typos
                region = as.factor(substring(region, 1, 4))
                ) %>%
  # remove cols not relecant to stats
  dplyr::select(-Status) %>%
  # remove any rows with missing values
  dplyr::filter(complete.cases(.))
summary(CEWL)
```

Next, split CEWL data by region and compute the average among them.

```{r}
# select each CEWL region separately 
CEWL_dorsum <- CEWL %>%
  dplyr::filter(region == "dors") %>%
  dplyr::select(date, individual_ID, 
                dorsum_TEWL_g_m2h = TEWL_g_m2h)
CEWL_ventrum <- CEWL %>%
  dplyr::filter(region == "vent") %>%
  dplyr::select(date, individual_ID, 
                ventrum_TEWL_g_m2h = TEWL_g_m2h)
CEWL_dewlap <- CEWL %>%
  dplyr::filter(region == "dewl") %>%
  dplyr::select(date, individual_ID, 
                dewlap_TEWL_g_m2h = TEWL_g_m2h)
CEWL_head <- CEWL %>%
  dplyr::filter(region == "head") %>%
  dplyr::select(date, individual_ID, 
                head_TEWL_g_m2h = TEWL_g_m2h)
CEWL_mitepatch <- CEWL %>%
  dplyr::filter(region == "mite") %>%
  dplyr::select(date, individual_ID, 
                mitepatch_TEWL_g_m2h = TEWL_g_m2h)

# also get average across body regions
CEWL_avg <- CEWL %>%
  group_by(individual_ID) %>%
  summarise(avg_CEWL = mean(TEWL_g_m2h)) %>%
  dplyr::select(individual_ID, avg_CEWL)
```


Finally, rearrange and re-join CEWL data.

```{r join data}
# join all CEWL regions to morpho and blood data
data_full <- morpho_blood_dat %>%
  left_join(CEWL_dorsum, by = c("date", "individual_ID")) %>%
  left_join(CEWL_ventrum, by = c("date", "individual_ID")) %>%
  left_join(CEWL_dewlap, by = c("date", "individual_ID")) %>%
  left_join(CEWL_head, by = c("date", "individual_ID")) %>%
  left_join(CEWL_mitepatch, by = c("date", "individual_ID")) %>%
  left_join(CEWL_avg, by = "individual_ID")
```


### Weather Data

This data was obtained from http://www.itrc.org/databases/precip/ (Adcon Server Data) to test the effect of ambient conditions on CEWL. This is different from the ambient conditions already measured with CEWL, which are the temperature and humidity around the measurement device at the time of measurement. We think that the temperature, humidity, *wind speed*, and *solar radiation* the lizard was exposed to prior to capture may also affect CEWL.

@ Dylan: did it not have wind speed and solar radiation available? those would be super helpful. Also, we need to know whether daylight savings is included or not bc if not, we need to shift the times by an hour.

@ Savannah: Wind Speed and Solar radiation are also available, I have downloaded the new csvs which should be included now into the big dataframe. I sent an email to ITRC to ask about daylight savings because there is nothing mentioned about it I feel like it would match the time on campus. 

```{r}
# load in csvs and put all in one dataframe
weather <- read.csv("./data/weather/4_5Weather.csv", sep = ';') %>%
  rbind(read.csv("./data/weather/4_19Weather.csv", sep = ';')) %>%
  rbind(read.csv("./data/weather/5_3Weather.csv", sep = ';')) %>%
  rbind(read.csv("./data/weather/5_10Weather.csv", sep = ';')) %>%
  rbind(read.csv("./data/weather/5_17Weather.csv", sep = ';')) %>%
  # add a variable for combined date-time
  mutate(collect_date_time = as.POSIXct(paste(Date, Time),
                                format = "%m/%d/%y %I:%M:%S %p")) %>%
  # remove lonely date and time
  dplyr::select(-Date, -Time)
```

The weather data is only every 15 minutes, but I want to match it to any minute measurement, so I need to interpolate the values for each minute.

First, make a separate dataframe with every minute for each of those days.

```{r}
all_times <- data.frame(collect_date_time = c(# April 5
                           seq(from = as.POSIXct("2021-04-05 10:00"),
                               to = as.POSIXct("2021-04-05 16:00"),
                               by="min"),
                           # April 19
                           seq(from = as.POSIXct("2021-04-19 10:00"),
                               to = as.POSIXct("2021-04-19 16:00"),
                               by="min"),
                           # April 26
                           seq(from = as.POSIXct("2021-04-26 10:00"),
                               to = as.POSIXct("2021-04-26 16:00"),
                               by="min"),
                           # May 3
                           seq(from = as.POSIXct("2021-05-03 10:00"),
                               to = as.POSIXct("2021-05-03 16:00"),
                               by="min"),
                           # May 10
                           seq(from = as.POSIXct("2021-05-10 10:00"),
                               to = as.POSIXct("2021-05-10 16:00"),
                               by="min"),
                           # May 17
                           seq(from = as.POSIXct("2021-05-17 10:00"),
                               to = as.POSIXct("2021-05-17 16:00"),
                               by="min")
                           ))

```

Next, merge the weather data into the times dataframe and interpolate the temperature and humidity between measurements.

```{r}
all_times_weather <- all_times %>% # time only dataframe
  # add weather measurements based on matching date-time
  left_join(weather, by = 'collect_date_time') %>%
  # convert temperature units, thanks America
  mutate(temp_C = fahrenheit.to.celsius(Temperature...F., round = 2),
         # interpolate temperatures
         temp_C_interpol = na.approx(temp_C),
         # interpolate humidities
         RH_percent_interpol = na.approx(Relative.Humidity....RH.),
         # interpolate Wind Speeds
         Wind_mph_interpol = na.approx(Wind.Speed..ave...mph.),
         # interpolate solar radiation
         Solar_rad_Wm2_interpol = na.approx(Pyranometer.0.2000.W.m²..W.m².)
         ) %>%
  # keep only the relevant variables
  dplyr::select(collect_date_time, temp_C_interpol, RH_percent_interpol, Wind_mph_interpol, Solar_rad_Wm2_interpol)

```


### Join Data 

There are several CEWL measurements for each of the other measures, so I'm going to join two ways. Each way allows slightly different analyses.

First, with CEWL as the primary dataframe. This means each of the other variables will be duplicated for each lizards CEWL measurements.

```{r}
all_data_long <- CEWL %>%
  left_join(morpho_blood_dat, 
            by = c("date", "individual_ID")
            ) %>%
  left_join(all_times_weather, 
            by = c("collect_date_time")
            )
```

Second, with morpho_blood_dat as the primary dataframe, and each region's CEWL measurement as an individual column.

```{r}
all_data_wide <- morpho_blood_dat %>%
  left_join(all_times_weather, 
            by = c("collect_date_time")
            ) %>%
  left_join(CEWL_dewlap,
            by = c("date", "individual_ID")
            ) %>%
  left_join(CEWL_dorsum,
            by = c("date", "individual_ID")
            ) %>%
  left_join(CEWL_head,
            by = c("date", "individual_ID")
            ) %>%
  left_join(CEWL_mitepatch,
            by = c("date", "individual_ID")
            ) %>%
  left_join(CEWL_ventrum,
            by = c("date", "individual_ID")
            )
```


# Check Data Distributions

## Histograms & Q-Q Plots

### SVL
skewed left
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = SVL_mm)) +
  geom_histogram(color = "black", fill="steelblue", bins=50) + 
  theme_classic() +
  xlab("SVL (mm)") + 
  ylab("Count")
simple.eda(all_data_wide$SVL_mm)
# Normality test if p > .05, data is normal. Data is not normal.
shapiro.test(all_data_wide$SVL_mm)
```

### mass
slightly skewed left, but nearly a bell curve:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = mass_g)) +
  geom_histogram(color = "black", fill="steelblue", bins=50) + 
  theme_classic() +
  xlab("Mass (g)") + 
  ylab("Count")
simple.eda(all_data_wide$mass_g)
# Normality test if p > .05, data is normal. Data is not normal.
shapiro.test(all_data_wide$mass_g)
```

### hematocrit 
looks pretty normally distributed around ~35%:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = hematocrit_percent)) +
  geom_histogram(color = "black", fill="steelblue", bins=50) + 
  theme_classic() +
  xlab("Hematocrit (%)") + 
  ylab("Count")
simple.eda(all_data_wide$hematocrit_percent)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$hematocrit_percent)
```

### osmolality 
also pretty normally distributed around ~370:
- normal: only variable to pass normality test
```{r}
all_data_wide %>%
  ggplot(., aes(x = osmolality_mmol_kg)) +
  geom_histogram(color = "black", fill="steelblue", bins=50) + 
  theme_classic() +
  xlab("Osmolality (mmol/kg)") + 
  ylab("Count")
simple.eda(all_data_wide$osmolality_mmol_kg)
# Normality test if p > .05, data is normal. Data is normal
shapiro.test(all_data_wide$osmolality_mmol_kg)
```

### cloacal temperature 
seems normally distributed:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = cloacal_temp_C)) +
  geom_histogram(color = "black", fill="steelblue", bins=10) + 
  theme_classic() +
  xlab("cloacal temperature (C)") + 
  ylab("Count")
simple.eda(all_data_wide$cloacal_temp_C)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$cloacal_temp_C)
```

### dewlap CEWL 
very skewed to the right:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = dewlap_TEWL_g_m2h)) +
  geom_histogram(color = "black", fill="steelblue", bins=50) + 
  theme_classic() +
  xlab("Dewlap CEWL (g/m^2/h)") + 
  ylab("Count")
simple.eda(all_data_wide$dewlap_TEWL_g_m2h)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$dewlap_TEWL_g_m2h)
```

### dorsum CEWL 
slightly skewed to the right:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = dorsum_TEWL_g_m2h)) +
  geom_histogram(color = "black", fill="steelblue", bins=40) + 
  theme_classic() +
  xlab("Dorsum CEWL (g/m^2/h)") + 
  ylab("Count")
simple.eda(all_data_wide$dorsum_TEWL_g_m2h)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$dorsum_TEWL_g_m2h)
```

### head CEWL 
very skewed to the right:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = head_TEWL_g_m2h)) +
  geom_histogram(color = "black", fill="steelblue", bins=40) + 
  theme_classic() +
  xlab("Head CEWL (g/m^2/h)") + 
  ylab("Count")
simple.eda(all_data_wide$head_TEWL_g_m2h)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$head_TEWL_g_m2h)
```

### mite patch CEWL 
very skewed to the right:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = mitepatch_TEWL_g_m2h)) +
  geom_histogram(color = "black", fill="steelblue", bins=40) + 
  theme_classic() +
  xlab("Mite Patch CEWL (g/m^2/h)") + 
  ylab("Count")
simple.eda(all_data_wide$mitepatch_TEWL_g_m2h)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$mitepatch_TEWL_g_m2h)
```

### ventrum CEWL 
slightly skewed to the right, somewhat evenly distributed:
- not normal
```{r}
all_data_wide %>%
  ggplot(., aes(x = ventrum_TEWL_g_m2h)) +
  geom_histogram(color = "black", fill="steelblue", bins=30) + 
  theme_classic() +
  xlab("Ventrum CEWL (g/m^2/h)") + 
  ylab("Count")
simple.eda(all_data_wide$ventrum_TEWL_g_m2h)
# Normality test if p > .05, data is normal. Data is not normal
shapiro.test(all_data_wide$ventrum_TEWL_g_m2h)
```


# Basic Figs & GLMs

## What affects hydration & health?

Potential relationships:
- Hct ~ SVL, mass, sex, gravidity, eye, hemolyzed, week
- Omol ~ SVL, mass, sex, gravidity, eye, hemolyzed, week

### Hct ~ SVL
- No sig relationship
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = hematocrit_percent, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = SVL_mm, 
                  y = hematocrit_percent, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("Hct") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_hct_SVL <- lm(hematocrit_percent ~ SVL_mm,
           data = all_data_wide)
summary(glm_hct_SVL)
```



### Osml ~ SVL
- no sig relationship
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = osmolality_mmol_kg, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = SVL_mm, 
                  y = osmolality_mmol_kg, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_osml_SVL <- lm(osmolality_mmol_kg ~ SVL_mm,
           data = all_data_wide)
summary(glm_osml_SVL)
```


### Hct ~ Mass
- no sig relationship
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = hematocrit_percent, 
                 ), 
             size = 1, 
             alpha = 0.6) +
  stat_smooth(aes(x = mass_g, 
                  y = hematocrit_percent, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_hct_mass <- lm(hematocrit_percent ~ mass_g,
           data = all_data_wide)
summary(glm_hct_mass)
```

### Osml ~ Mass
- no sig relationship
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = osmolality_mmol_kg, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = mass_g, 
                  y = osmolality_mmol_kg), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "gray",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_osml_mass <- lm(osmolality_mmol_kg ~ mass_g,
           data = all_data_wide)
summary(glm_osml_mass)
```


### Hct ~ Sex
- sig relationship, males have a higher hematocrit %
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = hematocrit_percent, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Sex", 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_hct_sex <- glm(hematocrit_percent ~ sex_M_F,
           data = all_data_wide)
summary(glm_hct_sex)
```



### Osml ~ Sex
- barely not significant (p=.0749), females have higher osmolarity
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = osmolality_mmol_kg, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Sex", 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_osml_sex <- lm(osmolality_mmol_kg ~ sex_M_F,
           data = all_data_wide)
summary(glm_osml_sex)
```

### Hct ~ Gravidity
- no sig diff
```{r}
all_data_wide %>% 
  dplyr::filter(sex_M_F == 'F') %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = gravid_Y_N, 
                   y = hematocrit_percent, 
                   color = gravid_Y_N
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Gravid", 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Gravid (Females Only)") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_hct_gravid <- lm(hematocrit_percent ~ gravid_Y_N,
           data = all_data_wide)
summary(glm_hct_gravid)
```

### Osml ~ Gravidity
- barely not significant (p=.0756), gravid F have higher osmolarity
```{r}
all_data_wide %>% 
  dplyr::filter(sex_M_F == 'F') %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = gravid_Y_N, 
                   y = osmolality_mmol_kg, 
                   color = gravid_Y_N
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Gravid", 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Gravid (Females Only)") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_osml_gravid <- lm(osmolality_mmol_kg ~ gravid_Y_N,
           data = all_data_wide)
summary(glm_osml_gravid)
```

### Hct ~ Sample Eye

```{r}
all_data_wide %>% 
  dplyr::filter(blood_sample_eye %in% c("R", "L")) %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = blood_sample_eye, 
                   y = hematocrit_percent, 
                   color = blood_sample_eye
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Blood Sample Eye", 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Blood Sample Eye") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# can't do a glm
```


### Osml ~ Sample Eye

```{r}
all_data_wide %>% 
  dplyr::filter(blood_sample_eye %in% c("R", "L")) %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = blood_sample_eye, 
                   y = osmolality_mmol_kg, 
                   color = blood_sample_eye
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Blood Sample Eye", 
                      values = c("green4", "salmon1") ) +
  theme_classic() + 
  xlab("Blood Sample Eye") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_osml_eye <- lm(osmolality_mmol_kg ~ blood_sample_eye,
           data = all_data_wide)
summary(glm_osml_eye)
```

### Hct ~ Hemolyzed/Not
- no sig diff
```{r}
all_data_wide %>% 
  dplyr::filter(hemolyzed %in% c("Y", "N")) %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = hemolyzed, 
                   y = hematocrit_percent, 
                   color = hemolyzed
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Blood Sample Eye", 
                      values = c("green4", "salmon1", "green4", "salmon1") ) +
  theme_classic() + 
  xlab("Whether or not Sample Hemolyzed") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_hct_hem <- lm(hematocrit_percent ~ hemolyzed,
           data = all_data_wide)
summary(glm_hct_hem)
```



### Osml ~ Hemolyzed/Not

```{r}
all_data_wide %>% 
  dplyr::filter(hemolyzed %in% c("Y", "N")) %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = hemolyzed, 
                   y = osmolality_mmol_kg, 
                   color = hemolyzed
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_colour_manual(name = "Blood Sample Eye", 
                      values = c("green4", "salmon1", "green4", "salmon1") ) +
  theme_classic() + 
  xlab("Whether or not Sample Hemolyzed") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_osml_hem <- lm(osmolality_mmol_kg ~ hemolyzed,
           data = all_data_wide)
summary(glm_osml_hem)
```



### Hct ~ Week
- no sig diff
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = as.factor(date), 
                   y = hematocrit_percent, 
                   color = as.factor(date)
                   ), 
               size = 1,
               alpha = 0.6) + 
  theme_classic() + 
  xlab("Sampling Date") + 
  ylab("Hematocrit") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_hct_wk <- lm(hematocrit_percent ~ date,
           data = all_data_wide)
summary(glm_hct_wk)
```



### Osml ~ Week
- Sig difference in osmolarity by week
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = as.factor(date), 
                   y = osmolality_mmol_kg, 
                   color = as.factor(date)
                   ), 
               size = 1,
               alpha = 0.6) + 
  theme_classic() + 
  xlab("Sampling Date") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
) -> osml_date_fig

#ggsave(filename = "max_points.png",
 #      plot = max_points,
  #     path = "./exported_figures",
   #    device = "png",
    #   dpi = 2400,
     #  width = 7, height = 5)

# glm
glm_osml_wk <- glm(osmolality_mmol_kg ~ date,
           data = all_data_wide)
summary(glm_osml_wk)
```

There was a little rain on April 27.... could that be why there was a slight drop in osmolality?! Not sure if the May 3-> 10 drop was because of rain or fixing the osmometer, though... Need to look for better daily rainfall records, maybe look in relation to humidity?.

### Humidity ~ Week
- Significant difference in humidity by week
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = as.factor(date), 
                   y = RH_percent_interpol, 
                   color = as.factor(date)
                   ), 
               size = 1,
               alpha = 0.6) + 
  theme_classic() + 
  xlab("Sampling Date") + 
  ylab("Relative Humidity") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm_hum_wk <- glm(RH_percent_interpol ~ date,
           data = all_data_wide)
summary(glm_hum_wk)

```

### Humidity ~ Osmolarity
- Sig difference, negative relationship. With every percent increase in relative humidity osmolarity drops 1.2.
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = RH_percent_interpol,
                 y = osmolality_mmol_kg, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = RH_percent_interpol, 
                  y = osmolality_mmol_kg), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "gray",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Relative Humidity") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_osml_hum <- lm(osmolality_mmol_kg ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm_osml_hum)
```

That's a pretty good relationship... 


### Hct ~ Humidity
- barely not significant (p=0.0734), 
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = RH_percent_interpol,
                 y = hematocrit_percent, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = RH_percent_interpol, 
                  y = hematocrit_percent), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "blue",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Relative Humidity at Capture (%)") + 
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_hct_RH <- lm(hematocrit_percent ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm_hct_RH)
```


### Hct ~ Temperature
- barely not signficant (0.062), as hematocrit increases ambient temp increases
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = temp_C_interpol,
                 y = hematocrit_percent, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = temp_C_interpol, 
                  y = hematocrit_percent), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "maroon",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Temperature at Capture (C)") + 
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_hct_temp <- lm(hematocrit_percent ~ temp_C_interpol,
           data = all_data_wide)
summary(glm_hct_temp)
```

### Osml ~ Temperature
- very strong positive relationship
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = temp_C_interpol,
                 y = osmolality_mmol_kg, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = temp_C_interpol, 
                  y = osmolality_mmol_kg), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              color = "maroon",
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Temperature at Capture (°C)") + 
  ylab("Osmolality (mmol/kg)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_osml_temp <- lm(osmolality_mmol_kg ~ temp_C_interpol,
           data = all_data_wide)
summary(glm_osml_temp)
```

### Hct ~ Individual
- not sig
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = individual_ID,
                 y = hematocrit_percent, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = individual_ID, 
                  y = hematocrit_percent, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Individual Lizard") + 
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_hct_ID <- lm(hematocrit_percent ~ individual_ID,
           data = all_data_wide)
summary(glm_hct_ID)
```

### Osml ~ Individual
- sig relationship...
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = individual_ID,
                 y = osmolality_mmol_kg, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = individual_ID, 
                  y = osmolality_mmol_kg, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              color = "gray",
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Individual Lizard") + 
  ylab("Osmolality") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm_osml_ID <- lm(osmolality_mmol_kg ~ individual_ID,
           data = all_data_wide)
summary(glm_osml_ID)
```



## Conclusion

Hydration seems to be affected by:
- mass (NS)
- sex (NS)
- gravid/not (NS)
- sample eye (NS)
- whether or not the sample was hemolyzed (NS)
- week/date of sampling!! (***)
- individual (*** but likely confounded with week/date...)
- capture temp & RH (both ***)

Health seems to be affected by:
- mass (NS)
- sex (*)
- capture temp & RH (NS)


Quick regression of individual_ID ~ date:

@Savannah: why have this, expect positive right?
```{r}
glm_date_ID <- lm(individual_ID ~ date,
           data = all_data_wide)
summary(glm_date_ID)
```


## What affects evaporative water loss?

Potential relationships:
- CEWL ~ date/week, 
        individual, 
        SVL, 
        mass, 
        gravidity, 
        hct, 
        osml, 
        cloacal temp, 
        ambient temp, 
        ambient RH, 
        measurement temp,
        measurement RH,
        **body region**

### CEWL ~ Body Region

```{r}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = region, 
                   y = TEWL_g_m2h, 
                   color = region
                   ), 
               size = 1,
               alpha = 0.6) + 
  scale_color_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  scale_x_discrete(labels = c("Dewlap", "Dorsum", "Head",
                              "Mite Patch", "Ventrum")) +
  theme_classic() + 
  xlab("Body Region") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# GLM
glm1 <- lm(TEWL_g_m2h ~ region, data = CEWL)
summary(glm1)

# base 
plot(TEWL_g_m2h ~ region, data=CEWL, ylab="TEWL", xlab="region", pch=20, col="blue")
abline(reg=glm1, col="orange")

# ggplot
ggplot(CEWL) + 
  geom_point(aes(region, TEWL_g_m2h), alpha=0.25, color="blue") + 
  geom_smooth(aes(region, TEWL_g_m2h, color="orange"), method="lm", se=T) + 
  labs(x="region", y="TEWL_g_m2h", title="")

visreg(glm1, overlay=T)
# I really like this visualization style, but I think I'll try to do it in ggplot

# Tukey
anova1 <- aov(glm1)
TukeyHSD(anova1)

# Model assumptions
plot(glm1, which = 3)
```



### CEWL ~ Osmolality

```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm2 <- lm(TEWL_g_m2h ~ region*osmolality_mmol_kg,
           data = all_data_long)
summary(glm2)

# base 
visreg(glm2, "osmolality_mmol_kg", by="region", overlay=T)

# Facet ggplot
ggplot(aes(osmolality_mmol_kg, TEWL_g_m2h), data = all_data_long) + 
  geom_point() + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 )+
    theme_classic() + 
  xlab("Osmolality") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)+
  facet_wrap(~ region) # create a facet for each body region
```

### Dorsum CEWL ~ Osmolality 
- Not sig
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = dorsum_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = dorsum_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "lightblue4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Dorsum CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)

# glm
glm2_dorsum <- lm(dorsum_TEWL_g_m2h ~ osmolality_mmol_kg,
           data = all_data_wide)
summary(glm2_dorsum)
```



### Ventrum CEWL ~ Osmolality 
- not sig barely (0.0536)
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = ventrum_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = ventrum_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "seashell4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Ventrum CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)

# glm
glm2_ventrum <- lm(ventrum_TEWL_g_m2h ~ osmolality_mmol_kg,
           data = all_data_wide)
summary(glm2_ventrum)
```



### Dewlap CEWL ~ Osmolality 
- sig
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = dewlap_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = dewlap_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "palegreen4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Dewlap CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)

# glm
glm2_dewlap <- lm(dewlap_TEWL_g_m2h ~ osmolality_mmol_kg,
           data = all_data_wide)
summary(glm2_dewlap)
```



### Mite Patch CEWL ~ Osmolality 
- not sig
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = mitepatch_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = mitepatch_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "lightpink3") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Mite Patch CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)

# glm
glm2_mitepatch <- lm(mitepatch_TEWL_g_m2h ~ osmolality_mmol_kg,
           data = all_data_wide)
summary(glm2_mitepatch)
```


### Head CEWL ~ Osmolality 
- not sig
```{r}
all_data_wide %>% 
  ggplot(data = .) + 
  geom_point(aes(x = osmolality_mmol_kg,
                 y = head_TEWL_g_m2h, 
                 ), 
             size = 1, 
             alpha = 0.6) + 
  stat_smooth(aes(x = osmolality_mmol_kg, 
                  y = head_TEWL_g_m2h, 
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1, 
              color = "plum4") + 
  theme_classic() + 
  xlab("Osmolality") + 
  ylab("Head CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0)

# glm
glm2_head <- lm(head_TEWL_g_m2h ~ osmolality_mmol_kg,
           data = all_data_wide)
summary(glm2_head)
```


### CEWL ~ Hematocrit

```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = hematocrit_percent,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = hematocrit_percent, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Hematocrit") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glms
# CEWL ~ region + hct
glm3 <- lm(TEWL_g_m2h ~ region*hematocrit_percent,
           data = all_data_long)
summary(glm3)
# dorsum CEWL ~ hct
glm3_dorsum <- lm(dorsum_TEWL_g_m2h ~ hematocrit_percent,
           data = all_data_wide)
summary(glm3_dorsum)
# ventrum CEWL ~ hct
glm3_ventrum <- lm(ventrum_TEWL_g_m2h ~ hematocrit_percent,
           data = all_data_wide)
summary(glm3_ventrum)
# dewlap CEWL ~ hct
glm3_dewlap <- lm(dewlap_TEWL_g_m2h ~ hematocrit_percent,
           data = all_data_wide)
summary(glm3_dewlap)
# head CEWL ~ hct
glm3_head <- lm(head_TEWL_g_m2h ~ hematocrit_percent,
           data = all_data_wide)
summary(glm3_head)
# mitepatch CEWL ~ hct
glm3_mitepatch <- lm(mitepatch_TEWL_g_m2h ~ hematocrit_percent,
           data = all_data_wide)
summary(glm3_mitepatch)

# base visualization
visreg(glm3, "hematocrit_percent", by="region", overlay=T, band=F)
```


### CEWL ~ Cloacal Temperature

```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = cloacal_temp_C,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = cloacal_temp_C, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Cloacal Temperature (°C)") + 
  ylab("CEWL (g/m^2/hr)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glms
# CEWL ~ region + ctemp
glm4 <- lm(TEWL_g_m2h ~ region*cloacal_temp_C,
           data = all_data_long)
summary(glm4)
# dorsum CEWL ~ ctemp
glm4_dorsum <- lm(dorsum_TEWL_g_m2h ~ cloacal_temp_C,
           data = all_data_wide)
summary(glm4_dorsum)
# ventrum CEWL ~ ctemp
glm4_ventrum <- lm(ventrum_TEWL_g_m2h ~ cloacal_temp_C,
           data = all_data_wide)
summary(glm4_ventrum)
# dewlap CEWL ~ ctemp
glm4_dewlap <- lm(dewlap_TEWL_g_m2h ~ cloacal_temp_C,
           data = all_data_wide)
summary(glm4_dewlap)
# head CEWL ~ ctemp
glm4_head <- lm(head_TEWL_g_m2h ~ cloacal_temp_C,
           data = all_data_wide)
summary(glm4_head)
# mitepatch CEWL ~ ctemp
glm4_mitepatch <- lm(mitepatch_TEWL_g_m2h ~ cloacal_temp_C,
           data = all_data_wide)
summary(glm4_mitepatch)

# base visualization
visreg(glm4, "cloacal_temp_C", by="region", overlay=T, band=F)
```


### CEWL ~ Capture Temperature

```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = temp_C_interpol,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = temp_C_interpol, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Temperature at Capture") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glms
# CEWL ~ region + capture temp
glm7 <- lm(TEWL_g_m2h ~ region*temp_C_interpol,
           data = all_data_long)
summary(glm7)
# dorsum CEWL ~ capture temp
glm7_dorsum <- lm(dorsum_TEWL_g_m2h ~ temp_C_interpol,
           data = all_data_wide)
summary(glm7_dorsum)
# ventrum CEWL ~ capture temp
glm7_ventrum <- lm(ventrum_TEWL_g_m2h ~ temp_C_interpol,
           data = all_data_wide)
summary(glm7_ventrum)
# dewlap CEWL ~ capture temp
glm7_dewlap <- lm(dewlap_TEWL_g_m2h ~ temp_C_interpol,
           data = all_data_wide)
summary(glm7_dewlap)
# head CEWL ~ capture temp
glm7_head <- lm(head_TEWL_g_m2h ~ temp_C_interpol,
           data = all_data_wide)
summary(glm7_head)
# mitepatch CEWL ~ capture temp
glm7_mitepatch <- lm(mitepatch_TEWL_g_m2h ~ temp_C_interpol,
           data = all_data_wide)
summary(glm7_mitepatch)
```


### CEWL ~ Capture Humidity
- sig
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = RH_percent_interpol,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = RH_percent_interpol, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Relative Humidity at Capture") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glms
# CEWL ~ region + capture RH
glm8 <- lm(TEWL_g_m2h ~ region*RH_percent_interpol,
           data = all_data_long)
summary(glm8)
# dorsum CEWL ~ capture RH
glm8_dorsum <- lm(dorsum_TEWL_g_m2h ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm8_dorsum)
# ventrum CEWL ~ capture RH
glm8_ventrum <- lm(ventrum_TEWL_g_m2h ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm8_ventrum)
# dewlap CEWL ~ capture RH
glm8_dewlap <- lm(dewlap_TEWL_g_m2h ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm8_dewlap)
# head CEWL ~ capture RH
glm8_head <- lm(head_TEWL_g_m2h ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm8_head)
# mitepatch CEWL ~ capture RH
glm8_mitepatch <- lm(mitepatch_TEWL_g_m2h ~ RH_percent_interpol,
           data = all_data_wide)
summary(glm8_mitepatch)
```


### CEWL ~ Measurement Temperature

```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = ambient_temp_C,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = ambient_temp_C, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Temperature During Measurement") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
# CEWL ~ region + aquaflux measurement temp
glm9 <- lm(TEWL_g_m2h ~ region*ambient_temp_C,
           data = all_data_long)
summary(glm9)
```


### CEWL ~ Measurement Humidity
- Very interesting relationship! Mite patch CEWL decreases as ambient humidity increases, but every other location appears to increase.
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = ambient_RH_percent,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = ambient_RH_percent, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Ambient Relative Humidity During Measurement") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
# CEWL ~ region + aquaflux measurement RH
glm9 <- lm(TEWL_g_m2h ~ region*ambient_RH_percent,
           data = all_data_long)
summary(glm9)
```

### CEWL ~ Wind Speed
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = Wind_mph_interpol,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = Wind_mph_interpol, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Average Windspeed During Measurement") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
# CEWL ~ region + aquaflux measurement RH
glm10 <- lm(TEWL_g_m2h ~ region*Wind_mph_interpol,
           data = all_data_long)
summary(glm10)
```

### CEWL ~ Solar Rad
- Definitely could have an effect may be worth testing in the model
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = Solar_rad_Wm2_interpol,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = Solar_rad_Wm2_interpol, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Solar Radiation W/m^2") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
# CEWL ~ region + aquaflux measurement RH
glm11 <- lm(TEWL_g_m2h ~ region*Solar_rad_Wm2_interpol,
           data = all_data_long)
summary(glm11)
```


### CEWL ~ Individual
- Same relationship with individual lizard...
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = individual_ID,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = individual_ID, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Individual Lizard") + 
  ylab("CEWL") + 
  
  # just to get a better look
  # ylim(5, 40) +
  
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm6 <- lm(TEWL_g_m2h ~ region*individual_ID,
           data = all_data_long)
summary(glm6)

# base visualization
visreg(glm6, "individual_ID", by="region", overlay=T, band=F)
```

### CEWL ~ SVL

```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = SVL_mm,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = SVL_mm, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("SVL") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm10 <- lm(TEWL_g_m2h ~ region*SVL_mm,
           data = all_data_long)
summary(glm10)
```

### CEWL ~ Mass
- head significant, but sig interaction. Opposite trend from all other body parts.
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_point(aes(x = mass_g,
                 y = TEWL_g_m2h, 
                 color = region
                 ), 
             size = 1, 
             alpha = 0.6) + 
  scale_colour_manual(values = c("palegreen4", "lightblue4", 
                                 "plum4", "lightpink3", "seashell4")) +
  stat_smooth(aes(x = mass_g, 
                  y = TEWL_g_m2h, 
                  color = region
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  theme_classic() + 
  xlab("Mass (g)") + 
  ylab("CEWL (g/m^2/hr)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 10),
        legend.text.align = 0,
)

# glm
glm11 <- lm(TEWL_g_m2h ~ region*mass_g,
           data = all_data_long)
summary(glm11)
```

### CEWL ~ Sex
-  Head sig higher in males. Vent sig higher in females.
```{r}
all_data_long %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = sex_M_F, 
                   y = TEWL_g_m2h, 
                   color = sex_M_F
                   ), 
               size = 1,
               alpha = 0.6) + 
  facet_wrap(~region) +
  scale_color_manual(values = c("royalblue1", "mediumorchid")) +
  scale_x_discrete(breaks = c(1,2,3)) +
  theme_classic() + 
  xlab("Sex") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm5 <- lm(TEWL_g_m2h ~ sex_M_F + region*sex_M_F, 
           data = all_data_long)
summary(glm5)

# base visualization
visreg(glm5, "sex_M_F", by="region", overlay=T, band=F)
```

### CEWL ~ Gravidity
- Sig: Head higher in gravid females. Vent higher in nongravid females.
```{r}
all_data_long %>% 
  dplyr::filter(sex_M_F == "F") %>%
  ggplot(data = .) + 
  geom_boxplot(aes(x = gravid_Y_N, 
                   y = TEWL_g_m2h, 
                   color = gravid_Y_N
                   ), 
               size = 1,
               alpha = 0.6) + 
  facet_wrap(~region) +
  scale_color_manual(values = c("royalblue1", "mediumorchid")) +
  scale_x_discrete(breaks = c(1,2,3)) +
  theme_classic() + 
  xlab("Female Gravid or Not") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm5 <- lm(TEWL_g_m2h ~ gravid_Y_N + region*gravid_Y_N, 
           data = all_data_long)
summary(glm5)

# base visualization
visreg(glm5, "gravid_Y_N", by="region", overlay=T, band=F)
```


### CEWL ~ Week

```{r}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = as.factor(date), 
                   y = TEWL_g_m2h, 
                   color = as.factor(date)
                   ), 
               size = 1,
               alpha = 0.6) + 
  facet_wrap(~region) + # could not figure out how to change facet labels without changing underlying data
  scale_color_manual(values = c("royalblue1", "mediumorchid", "seagreen4",
                                "royalblue1", "mediumorchid", "seagreen4")) +
  scale_x_discrete(breaks = c(1,2,3)) +
  theme_classic() + 
  xlab("Date") + 
  ylab("CEWL") + 
  theme(text = element_text(color = "black", family = "sans", size = 12),
        axis.text = element_text(color = "black", family = "sans", size = 10),
        legend.text.align = 0,
        legend.position = "none"
)

# glm
glm12 <- lm(TEWL_g_m2h ~ region*date,
           data = all_data_long)
summary(glm12)
```

## Conclusion

visually, CEWL seems to be affected by:
- body region - significant!
- osmolality (hydration) - only significant for dewlap
- hematocrit (health) - not significant for any region
- cloacal temperature at measurement!! - sig overall and for each region individually except mite patch
- capture temp - sig overall and for ventrum, dewlap, and mitepatch regions individually
- capture RH - sig overall and for dorsum, dewlap, and mitepatch regions individually (not head or ventrum)
- measurement temperature - sig overall, didn't test individually
- individual ID - significant
- mass & SVL - both significant overall
- week/date - significant

*not* affected by sex, gravidity, or measurement RH (not visually or statistically significant)





# PCA

```{r}

## Subset location and explanatory data
locations <- all_data_wide[, 19:23]
explanatory <- all_data_wide[, c(4,5,10,11,15:18)]

## Remove NA
locations <- na.omit(locations)
explanatory <- na.omit(explanatory)

## Create PCAs
#### CEWL all locations PCA
data.pca <- prcomp(locations, center=T, scale. = T)
summary(data.pca)

#### CEWL avg PCA
data2.pca <- prcomp(explanatory, center=T, scale. = T)
summary(data2.pca)

## Plots
### CEWL all locations, gender groups
ggbiplot(data.pca, labels=rownames(data.pca))

### CEWL avg, gender groups
ggbiplot(data2.pca, labels=rownames(data.pca))

```



# GLMMs

## Hydration

Based on the simple linear models and figures above, osmolality should be predicted by date/week, individual, capture temperature, and capture RH.

### Multicollinearity

First, check for multicollinearity among independent variables:

```{r}
all_data_wide %>% 
  # select variables of interest
  dplyr::select(date,
                individual_ID,
                temp_C_interpol,
                RH_percent_interpol
                ) %>% 
  # multicollinearity plot
  pairs(.)

# also make another plot with r-sq values
# date variable doesn't work for this because not continuous numeric
all_data_wide %>% 
  # select variables of interest
  dplyr::select(individual_ID,
                temp_C_interpol,
                RH_percent_interpol
                ) %>% 
  # multicollinearity plot
  chart.Correlation(., histogram = F, pch = 19)
```

Date and individual_ID are collinear, as are capture temperature and RH. Individual_ID is significantly correlated with capture RH, but the r-squared is relatively low, so I think it's okay to keep both. 

In conclusion, individual_ID *or* date and capture temperature *or* RH should be used in the model.

Prep dataframe for computing models:

```{r}
hydrat_mod_dat <- all_data_wide %>%
  dplyr::select(date, 
                individual_ID,
                osmolality_mmol_kg,
                temp_C_interpol,
                RH_percent_interpol
                ) %>%
  dplyr::filter(complete.cases(.))
```

### Models

```{r, hydration models}
# model 1: osml ~ date + temp
# AIC = 1319.6
hydrat_mod1 <- glm(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ date + temp_C_interpol) 
summary(hydrat_mod1)

# model 2: osml ~ date + RH
# AIC = 1298.2
hydrat_mod2 <- glm(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ date + RH_percent_interpol) 
summary(hydrat_mod2)

# model 3: osml ~ individual (fixed) + temp
# AIC = 1321.3
hydrat_mod3 <- glm(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ individual_ID + temp_C_interpol) 
summary(hydrat_mod3)

# model 4: osml ~ individual (fixed) + RH
# AIC = 1305.6
hydrat_mod4 <- glm(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ individual_ID + RH_percent_interpol) 
summary(hydrat_mod4)

# model 5: osml ~ individual (random) + temp
# AIC = 1217.8 ** tied for best model
hydrat_mod5 <- nlme::lme(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ temp_C_interpol, random = ~1|individual_ID) 
summary(hydrat_mod5)

# model 6: osml ~ individual (random) + RH
# AIC = 1246.9
hydrat_mod6 <- nlme::lme(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ RH_percent_interpol, random = ~1|individual_ID) 
summary(hydrat_mod6)

# model 7: osml ~ individual (random) + RH*temp interaction
# AIC = 1217.09	** tied for best model
hydrat_mod7 <- nlme::lme(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ RH_percent_interpol * temp_C_interpol, random = ~1|individual_ID) 
summary(hydrat_mod7)
```


The best model to predict hydration is based on ambient temperature at capture as a fixed effect and individual_ID as a random effect (hydrat_mod5). Using the interaction between RH * temperature gives just as good a model (hydrat_mod7). Both have AIC of 1217. 


### Selection

I should try to drop terms and see if that improves the models at all. Model 7 includes the variables from model 5, so I'll drop terms from model 7.

```{r}
# without temperature
hydrat_mod7_step1 <- nlme::lme(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ RH_percent_interpol * temp_C_interpol - temp_C_interpol, random = ~1|individual_ID) 
summary(hydrat_mod7_step1)

# compare to with
anova(hydrat_mod7, hydrat_mod7_step1)
```

Deleting temperature is not an improvement, AIC is much higher and the model is significantly worse.

```{r}
# without RH
hydrat_mod7_step2 <- nlme::lme(data = hydrat_mod_dat,
                         osmolality_mmol_kg ~ RH_percent_interpol * temp_C_interpol - RH_percent_interpol, random = ~1|individual_ID) 
summary(hydrat_mod7_step2)

# compare to with
anova(hydrat_mod7, hydrat_mod7_step2)
```

Deleting RH is also not an improvement, AIC is much higher and the model is significantly worse without it.

I would conclude that the two best models are best in their fullest version.


### Conclusion

Now save both of the best two models.

```{r}
# save step 6 summary object
osml_best_mod1 <- summary(hydrat_mod5)
# extract stats table from summary object
osml_best_mod1_vals <- data.frame(osml_best_mod1$tTable)
# export 
write.csv(osml_best_mod1_vals, "osml_best_mod1_vals.csv")

# save step 9 summary object
osml_best_mod2 <- summary(hydrat_mod7)
# extract stats table from summary object
osml_best_mod2_vals <- data.frame(osml_best_mod2$tTable)
# export 
write.csv(osml_best_mod2_vals, "osml_best_mod2_vals.csv")
```


## CEWL

Based on the simple linear models and figures above, CEWL should be predicted by:
- body region
- hydration (osmolality)
- cloacal temperature at measurement
- capture temperature and RH
- ambient temperature at measurement
- individual
- mass & SVL
- date/week


Prep dataframe for models:

```{r}
CEWL_mod_dat <- all_data_long %>% 
  # select variables of interest
  dplyr::select(date,
                individual_ID,
                mass_g,
                SVL_mm,
                osmolality_mmol_kg,
                TEWL_g_m2h,
                region,
                cloacal_temp_C,
                temp_C_interpol,
                RH_percent_interpol,
                ambient_temp_C
                ) %>%
  dplyr::filter(complete.cases(.))
```


### Multicollinearity

Check for multicollinearity among independent variables:

```{r}
CEWL_mod_dat %>% 
  # get rid of dependent variable
  dplyr::select(-TEWL_g_m2h) %>%
  # multicollinearity plot
  pairs(.)

# also make another plot with r-sq values
# non-numeric variables don't work for this
CEWL_mod_dat %>% 
  # select variables of interest
  dplyr::select(-TEWL_g_m2h, -date, -region) %>% 
  # multicollinearity plot
  chart.Correlation(., histogram = F, pch = 19)
```

collinear variables that should not be used in combination:
- mass and SVL
- temperature and RH at capture (same from hydration multicollinearity)
- date and individual_ID


### Models

```{r}
# model 1
# AIC = 5175.665
CEWL_mod1 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          RH_percent_interpol + SVL_mm, 
                          random = ~1|individual_ID) 
summary(CEWL_mod1)

# model 2
# AIC = 5171.271
CEWL_mod2 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          RH_percent_interpol + mass_g, 
                          random = ~1|individual_ID) 
summary(CEWL_mod2)

# model 3
# AIC = 5166.725
CEWL_mod3 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol + SVL_mm, 
                          random = ~1|individual_ID) 
summary(CEWL_mod3)

# model 4
# AIC = 5163.566 ** best model ** 
CEWL_mod4 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol + mass_g, 
                          random = ~1|individual_ID) 
summary(CEWL_mod4)

# model 5
# AIC = 5208
CEWL_mod5 <- glm(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol + SVL_mm + date) 
summary(CEWL_mod5)

# model 6
# AIC = 5205.1
CEWL_mod6 <- glm(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol + mass_g + date) 
summary(CEWL_mod6)

# model 7
# AIC = 5219.7
CEWL_mod7 <- glm(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          RH_percent_interpol + SVL_mm + date) 
summary(CEWL_mod7)

# model 8
# AIC = 5214.3
CEWL_mod8 <- glm(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          RH_percent_interpol + mass_g + date) 
summary(CEWL_mod8)

# model 9 = model 4, but with RH*temp interaction
# AIC = 5164.786 ** nearly as good as best model ** 
CEWL_mod9 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol*RH_percent_interpol + mass_g, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9)
```

Now that I know which of the collinear variables are better to use, I can use model 9 and drop terms to simplify them as much as possible to find the simplest, best model.


### Selection

It's hard to automate model selection for a mixed-effects model, so I'll do it manually. 

Extract significance values from model 9:

```{r}
# save summary object
CEWL_mod9_sum <- summary(CEWL_mod9)
# extract stats table from summary object
CEWL_mod9_important_vals <- data.frame(CEWL_mod9_sum$tTable) %>%
  # arrange rows by most->least significant p-value
  dplyr::arrange(., p.value)
```

Osmolality, ambient temp at measurement, and capture RH and temperature can be dropped to see if the model improves. Some of the regions aren't significant, but others are, so I'll keep that variable because it's also our main variable of interest.

I can also check dropterm, but I have to use on a glm with only fixed effects:

```{r}
CEWL_mod_simple <- glm(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + osmolality_mmol_kg +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol*RH_percent_interpol + mass_g
                          + individual_ID) 
dropterm(CEWL_mod_simple)
```

It seems like no deletions would result in a delta-AIC >2, but I'll still try dropping some terms from the mixed-effect model.

```{r}
# without osmolality
CEWL_mod9_step1 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol*RH_percent_interpol + mass_g, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step1)

# compare to with
anova(CEWL_mod9, CEWL_mod9_step1)
```


The model is significantly better *without* osmolality as a predictor, so leave out and try next deletion:

```{r}
# without capture temperature
CEWL_mod9_step2 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol*RH_percent_interpol + mass_g -
                          temp_C_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step2)

# compare to with
anova(CEWL_mod9_step1, CEWL_mod9_step2)
```

Model is significantly better *with* temperature predictor... try omitting RH instead:

```{r}
# without capture RH
CEWL_mod9_step3 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region +
                          cloacal_temp_C + ambient_temp_C +
                          temp_C_interpol*RH_percent_interpol + mass_g -
                          RH_percent_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step3)

# compare to with
anova(CEWL_mod9_step1, CEWL_mod9_step3)
```

Model is significantly better *with* capture RH predictor... try omitting ambient measurement temperature instead:

```{r}
# without measurement temperature
CEWL_mod9_step4 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + cloacal_temp_C + mass_g +
                          temp_C_interpol*RH_percent_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step4)

# compare to with
anova(CEWL_mod9_step1, CEWL_mod9_step4)

# compare to omitting capture temperature
anova(CEWL_mod9_step2, CEWL_mod9_step4)
```

The delta-AIC is <2 and the difference between having measurement temperature or not is non-significant. Omitting measurement temperature is also better than omitting capture temperature, so we will drop it. 

Now, look at the difference between having cloacal temperature versus capture temperature in the model:

```{r}
# without cloacal temperature
CEWL_mod9_step5 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + mass_g +
                          temp_C_interpol*RH_percent_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step5)

# compare to with
anova(CEWL_mod9_step4, CEWL_mod9_step5)

# compare to omitting capture temperature instead
CEWL_mod9_step6 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + mass_g + cloacal_temp_C +
                          temp_C_interpol*RH_percent_interpol -
                           temp_C_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step6)
anova(CEWL_mod9_step6, CEWL_mod9_step5)

# what if cloacal temperature interacts with capture RH
CEWL_mod9_step7 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + mass_g +
                          cloacal_temp_C*RH_percent_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step7)
anova(CEWL_mod9_step6, CEWL_mod9_step7)
anova(CEWL_mod9_step5, CEWL_mod9_step7)
```

Comparing steps 4 and 5, the model is significantly better *with* cloacal temperature. Comparing steps 5 and 6, omitting capture temperature is significantly better than omitting cloacal temperature. Finally, if we replace capture temperature with cloacal temperature in an interaction with capture RH (step 7), there's only an AIC difference of 2, so either could be fine. Steps 6 and 7 are equally good. But, looking more closely, 6 has more significant coefficients, so it would be a better choice.

Finally, see if step 6 improves if we remove RH and only keep its interaction:

```{r}
# without capture RH, interaction only
CEWL_mod9_step8 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + mass_g + cloacal_temp_C +
                          temp_C_interpol*RH_percent_interpol -
                           temp_C_interpol - RH_percent_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step8)

# compare to with
anova(CEWL_mod9_step6, CEWL_mod9_step8)
```

Without RH is better, but not significantly. Now the interaction between capture temperature and RH is not a significant predictor, though, so test whether it should be removed:

```{r}
# without interaction at all
CEWL_mod9_step9 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region + mass_g + cloacal_temp_C, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step9)

# compare to with
anova(CEWL_mod9_step6, CEWL_mod9_step9)
anova(CEWL_mod9_step8, CEWL_mod9_step9)
```

Step 9 is significantly better than step 8, and also better than step 6 based on AIC, but not significantly, so I could choose either step 6 or step 9. Since humidity was one thing we predicted to be important, I think I would choose to keep it, even though delta-AIC was >2. 

Try adding a body region * mass interaction term based on new figure interpretation:

```{r}
# try adding region*mass interaction to step 6
CEWL_mod9_step10 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region*mass_g + cloacal_temp_C +
                          temp_C_interpol*RH_percent_interpol -
                           temp_C_interpol, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step10)

# compare
anova(CEWL_mod9_step6, CEWL_mod9_step10)
anova(CEWL_mod9_step9, CEWL_mod9_step10)
```

Adding the interaction term to what was step 6 made it way better than both step 6 and step 9. 

Also test if adding interaction to step 9 keeps the interaction versions of steps 6 and 9 equally good again.

```{r}
# try adding region*mass interaction to step 9
CEWL_mod9_step11 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region*mass_g + cloacal_temp_C, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step11)

# compare
anova(CEWL_mod9_step6, CEWL_mod9_step11)
anova(CEWL_mod9_step9, CEWL_mod9_step11)
anova(CEWL_mod9_step10, CEWL_mod9_step11)
```

Step 11 is non-significantly better than step 10, and both are significantly better than steps 6 and 9. Thus, the two best models now both include a region*mass interaction term.

Double check that dropping the individual terms outside the interactions does not improve the model:

```{r}
# remove individual region term from step 11
CEWL_mod9_step12 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region*mass_g + cloacal_temp_C - region, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step12)

# compare
anova(CEWL_mod9_step11, CEWL_mod9_step12)
```

That did not improve AIC, so nect try removing mass term:

```{r}
# remove individual mass term from step 11
CEWL_mod9_step13 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region*mass_g + cloacal_temp_C - mass_g, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step13)

# compare
anova(CEWL_mod9_step12, CEWL_mod9_step13)
```

That resulted in a significantly better model with much lower AIC, so we will leave out the individual mass term. 

Finally, also check these removals for step 10:

```{r}
# remove individual region term from step 10
CEWL_mod9_step14 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region*mass_g + cloacal_temp_C +
                          temp_C_interpol*RH_percent_interpol -
                           temp_C_interpol - region, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step14)

# compare
anova(CEWL_mod9_step10, CEWL_mod9_step14)
```

And, just like the other dropterm test, removing the individual region predictor makes the model significantly worse.

Try mass:

```{r}
# remove individual mass term from step 10
CEWL_mod9_step15 <- nlme::lme(data = CEWL_mod_dat,
                         TEWL_g_m2h ~ region*mass_g + cloacal_temp_C +
                          temp_C_interpol*RH_percent_interpol -
                           temp_C_interpol - mass_g, 
                          random = ~1|individual_ID) 
summary(CEWL_mod9_step15)

# compare
anova(CEWL_mod9_step10, CEWL_mod9_step15)
```

In this case, steps 10 and 15 are equally as good as each other, with exactly the same AIC values. Since the singular mass term was a significant predictor in step 10, I think it should be kept in this version of the model. 


### Conclusion

Steps 10 and 13 were the best models.

```{r}
# save step 10 summary object
CEWL_best_mod1 <- summary(CEWL_mod9_step10)
# extract stats table from summary object
CEWL_best_mod1_vals <- data.frame(CEWL_best_mod1$tTable)
# export 
write.csv(CEWL_best_mod1_vals, "CEWL_best_mod1_vals.csv")

# save step 13 summary object
CEWL_best_mod2 <- summary(CEWL_mod9_step13)
# extract stats table from summary object
CEWL_best_mod2_vals <- data.frame(CEWL_best_mod2$tTable)
# export 
write.csv(CEWL_best_mod2_vals, "CEWL_best_mod2_vals.csv")
```






# to-do:

1. add a region*mass interaction effect for CEWL
2. add in rain events to see if they match-up with drops in osmolality
3. do osmolality ~ cm rain in the past week?
3. would an ANOVA be better to determine differences between each of the body regions? I think GLM only compares each to dewlap, not each to each.
- ANOVA with tukey, I added tukey in above at the CEWL versus region. Could make a visualizationon box graph with different letters.
4. look at how model stats are presented in tables and model it after that


b.	Calculate estimates of TEWL based on equations presented in (6).  How much do the estimates vary depending on which CEWL we use? Can we figure out how to use all of our different CEWL measurements to calculate what we think would be an accurate TEWL?






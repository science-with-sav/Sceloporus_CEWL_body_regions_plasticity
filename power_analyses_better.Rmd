---
title: "Power Analysis for Future Hydration Studies"
author: "Savannah Weaver"
date: "Spring Quarter 2021"
output: pdf_document
---

# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
if (!require("pwr")) install.packages("pwr")
library("pwr")
```


# Goals

Perform a power analysis on preliminary data to figure out how many lizards I would need to have in my study to find significant differences between hematocrit, osmolality, and evaporative water loss, if those differences are there. 

Factors to remember/include:
- 2x2 factorial treatment groups
- measurements over time (start, middle, end)
- trial number



# Data

### Load Experiment Checkup Data

```{r exp data}
exp_dat <- read.csv("./data/experimental_data.csv",
                             na.strings=c("","NA") # fix empty cells
                             ) %>%
  dplyr::mutate(date = as.Date(date, format = "%m/%d/%y"),
                time = as.POSIXct(time, format = "%H:%M"),
                blood_sample_eye = as.factor(blood_sample_eye),
                hemolyzed = as.factor(hemolyzed),
                rehydration = as.factor(rehydration),
                #individual_ID = as.character(individual_ID)
                ) %>%
  dplyr::select(-notes, -rehydration) %>%
  dplyr::filter(osmolality_mmol_kg <= 500) # remove one point I think inaccurate
summary(exp_dat)
```



### Load Treatment Group Assignments

```{r}
tmt_groups <- read.csv("./data/exp_tmt_assignment.csv",
                             na.strings=c("","NA") # fix empty cells
                             ) %>%
  dplyr::filter(temp_tmt_C == 25) %>%
  dplyr::mutate(trial_number = as.factor(trial_number),
                humidity_tmt_percent = as.factor(humidity_tmt_percent),
                #individual_ID = as.character(individual_ID)
                ) %>%
  dplyr::select(-notes)
summary(tmt_groups)
```



# Data Prep

```{r}
power_dat <- exp_dat %>%
  group_by(individual_ID) %>%
  dplyr::filter(date == max(date) & rehydration == "pre") %>%
  left_join(tmt_groups, by = 'individual_ID') %>%
  dplyr::filter(complete.cases(temp_tmt_C))
```

Now I want to do a power analysis for finding differences in osmolarity and hematocrit in humid vs dry treatment, but the next study will have 4 groups instead of 2: humid/dry * hot/cool.

I also want to know differences over time, but I'm having data wrangling troubles.


# Basic Look at Differences

```{r}
differences <- power_dat %>%
  group_by(humidity_tmt_percent) %>%
  summarise(hct = mean(hematocrit_percent),
            osmol = mean(osmolality_mmol_kg))
differences
```




# Power Analyses

This is just the code I plan to use, I am still confused on how to use it.

```{r}
# ANOVA with our current sample sizes
pwr.anova.test(k = 4, # number of groups (M/F x control/hydration)
               n = 8, # x individuals in each group 
               f = 0.1, # want to be able to detect small effects 
               sig.level = 0.05
                 )
# ANOVA to find out n per group
pwr.anova.test(k = 4, # number of groups (M/F x control/hydration)
               f = 0.1, # want to be able to detect small effects 
               sig.level = 0.05, 
               power = 0.9
                 )
# not complicated enough to use for more than a 1-way ANOVA
```





- run a model on the data I currently have is --> look at mean squared error then use that as my variability estimate
- might have to ignore trial effect for now
- another package is cluster power... can email him packages if I'm interested in them






















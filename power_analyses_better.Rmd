---
title: "Power Analysis for Future Hydration Studies"
author: "Savannah Weaver"
date: "June 2021"
output: pdf_document
---

# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
if (!require("pwr")) install.packages("pwr")
library("pwr")
if (!require("nlme")) install.packages("nlme")
library("nlme") # for LMMs
```


# Goals

Perform a power analysis on preliminary data to figure out how many lizards I would need to have in my study to find significant differences between hematocrit, osmolality, and evaporative water loss, if those differences are there. 

Factors to remember/include:
- 2x2 factorial treatment groups
- measurements over time (start, middle, end)
- trial number



# Load Data

```{r load data}
CEWL <- read.csv("./exported_data/exp_effects_CEWL.csv",
                             na.strings=c("","NA")
                             ) %>%
  dplyr::mutate(date = as.Date(date, format = "%Y-%m-%d"),
                region = as.factor(region),
                humidity_tmt_percent = as.factor(humidity_tmt_percent)
                ) %>%
  dplyr::select(-notes, -X) %>%
  dplyr::filter(complete.cases(.))
summary(CEWL)
hydration <- read.csv("./exported_data/exp_effects_hydration.csv",
                             na.strings=c("","NA")
                             ) %>%
  dplyr::filter(type %in% c("exp", "capture")) %>%
  dplyr::mutate(date = as.Date(date, format = "%Y-%m-%d"),
                type = as.factor(type),
                humidity_tmt_percent = as.factor(humidity_tmt_percent)
                ) %>%
  dplyr::select(-X) 
summary(hydration)
```





# Data Prep

Since my first try of doing this experiment only had temperature 25C, I'm going to duplicate the data and remake it as 35C so I can build a model off of that.

## Hydration

```{r}
# make fake
fake_35C_hyd <- hydration %>%
  mutate(temp_tmt_C = 35)

# join
fake_hydration_dat <- fake_35C_hyd %>%
  rbind(hydration)
```

## CEWL

```{r}
# make fake
fake_35C_CEWL <- CEWL %>%
  mutate(temp_tmt_C = 35)

# join
fake_CEWL_dat <- fake_35C_CEWL %>%
  rbind(CEWL)
```



# Create Models

## Osmolality

```{r}
osmol_mod <- nlme::lme(data = fake_hydration_dat,
                         osmolality_mmol_kg ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent +
                         day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(osmol_mod)
```


## Hematocrit

```{r}
hct_mod <- nlme::lme(data = fake_hydration_dat,
                         hematocrit_percent ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent +
                         day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(hct_mod)
```


## Mass

```{r}
mass_mod <- nlme::lme(data = fake_hydration_dat,
                         mass_g ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent +
                         day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(mass_mod)
```


## CEWL

```{r}
CEWL_mod <- nlme::lme(data = fake_CEWL_dat,
                         TEWL_g_m2h ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent + region +
                        # it won't add region for some reason... 
                          day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(osmol_mod)
```




# Power Analyses

This is just the code I plan to use, I am still confused on how to use it.

```{r}
# ANOVA with our current sample sizes
pwr.anova.test(k = 4, # number of groups (M/F x control/hydration)
               n = 8, # x individuals in each group 
               f = 0.1, # want to be able to detect small effects 
               sig.level = 0.05
                 )
# ANOVA to find out n per group
pwr.anova.test(k = 4, # number of groups (M/F x control/hydration)
               f = 0.1, # want to be able to detect small effects 
               sig.level = 0.05, 
               power = 0.9
                 )
# not complicated enough to use for more than a 1-way ANOVA
```



Notes from JW chat:

- run a model on the data I currently have is --> look at mean squared error then use that as my variability estimate
- might have to ignore trial effect for now
- another package is cluster power... can email him packages if I'm interested in them






















---
title: "Power Analysis for Future Hydration Studies"
author: "Savannah Weaver"
date: "June 2021"
output: pdf_document
---

# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
if (!require("pwr")) install.packages("pwr")
library("pwr") # basic power analysis
if (!require("simr")) install.packages("simr")
library("simr") # more complex power analysis
if (!require("nlme")) install.packages("nlme")
library("nlme") # for LMMs
```


# Goals

Perform a power analysis on preliminary data to figure out how many lizards I would need to have in my study to find significant differences between hematocrit, osmolality, and evaporative water loss, if those differences are there. 

Factors to remember/include:
- 2x2 factorial treatment groups
- measurements over time (start, middle, end)
- trial number



# Load Data

```{r load data}
CEWL <- read.csv("./exported_data/exp_effects_CEWL.csv",
                             na.strings=c("","NA")
                             ) %>%
  dplyr::mutate(date = as.Date(date, format = "%Y-%m-%d"),
                region = as.factor(region),
                humidity_tmt_percent = as.factor(humidity_tmt_percent)
                ) %>%
  dplyr::select(-notes, -X) %>%
  dplyr::filter(complete.cases(.))
summary(CEWL)
hydration <- read.csv("./exported_data/exp_effects_hydration.csv",
                             na.strings=c("","NA")
                             ) %>%
  dplyr::filter(type %in% c("exp", "capture")) %>%
  dplyr::mutate(date = as.Date(date, format = "%Y-%m-%d"),
                type = as.factor(type),
                humidity_tmt_percent = as.factor(humidity_tmt_percent)
                ) %>%
  dplyr::select(-X) 
summary(hydration)
```





# Data Prep

Since my first try of doing this experiment only had temperature 25C, I'm going to duplicate the data and remake it as 35C so I can build a model off of that.

## Hydration

```{r}
# make fake
fake_35C_hyd <- hydration %>%
  mutate(temp_tmt_C = 35)

# join
fake_hydration_dat <- fake_35C_hyd %>%
  rbind(hydration)
```

## CEWL

```{r}
# make fake
fake_35C_CEWL <- CEWL %>%
  mutate(temp_tmt_C = 35)

# join
fake_CEWL_dat <- fake_35C_CEWL %>%
  rbind(CEWL) %>%
  # make indiv ID and trial num factors
  mutate(individual_ID = as.factor(individual_ID),
         trial_number = as.factor(trial_number))
summary(fake_CEWL_dat)
```



# Create Models

## Osmolality

```{r}
osmol_mod <- nlme::lme(data = fake_hydration_dat,
                         osmolality_mmol_kg ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent +
                         day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(osmol_mod)
osmol_mod_mse <- (mean(osmol_mod$residuals^2)) # 646.0459
```


## Hematocrit

```{r}
hct_mod <- nlme::lme(data = fake_hydration_dat,
                         hematocrit_percent ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent +
                         day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(hct_mod)
hct_mod_mse <- (mean(hct_mod$residuals^2)) # 28.64746
```


## Mass
### Should this be BCI??

```{r}
mass_mod <- nlme::lme(data = fake_hydration_dat,
                         mass_g ~ 
                         # idk how to code temp to prevent pseudoreplication
                         temp_tmt_C * humidity_tmt_percent +
                         day, 
                       random = c(~1|trial_number, ~1|individual_ID))
summary(mass_mod)
mass_mod_mse <- (mean(mass_mod$residuals^2)) # 2.126061
```


## CEWL

```{r}
CEWL_mod <- lme4::lmer(data = fake_CEWL_dat,
                         TEWL_g_m2h ~ 
                         # idk how to code temp to prevent pseudoreplication
                         # colon for interaction only
                         humidity_tmt_percent*day + region +
                        # it won't add region for some reason... 
                        
                       (1|trial_number/individual_ID)) # nest indiv within trial num
summary(CEWL_mod)
CEWL_mod_mse <- (mean(CEWL_mod$residuals^2)) # 207.7879
```




# Power Analyses

Not working... 

```{r}
powerSim(CEWL_mod, fixed("humidity_tmt_percent:day", "lr"), nsim = 20)
# pwr more interesting for nonsig model effects
powerSim(CEWL_mod)
```
























